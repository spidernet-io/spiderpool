# Default values for spiderpool.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

rbac:
  # -- Enable creation of Resource-Based Access Control configuration.
  create: true

# default spiderpool
nameOverride: ""

configMap:
  name: spiderpool

## @param commonAnnotations Annotations to add to all deployed objects
##
commonAnnotations: {}
#  annotation1: v1
#  annotation2: v2

## @param commonLabels Labels to add to all deployed objects
##
commonLabels: {}
#  label1: v1
#  labele: v2

# example CA cert, and expiry time is 100 years
# encoded
ca:
  cert: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUR2ekNDQXFlZ0F3SUJBZ0lVWml0TXk5L3VkaWtjd3htV1NmY1cxQS9KdEZNd0RRWUpLb1pJaHZjTkFRRUwKQlFBd2J6RUxNQWtHQTFVRUJoTUNZMjR4RVRBUEJnTlZCQWdNQ0hOb1lXNW5hR0ZwTVJFd0R3WURWUVFIREFoegphR0Z1WjJoaGFURVNNQkFHQTFVRUNnd0pjM0JwWkdWeWJtVjBNUkl3RUFZRFZRUUxEQWx6Y0dsa1pYSnVaWFF4CkVqQVFCZ05WQkFNTUNYTndhV1JsY201bGREQWVGdzB5TWpBMk1ERXhOekV5TXpsYUZ3MHpNakExTWpreE56RXkKTXpsYU1HOHhDekFKQmdOVkJBWVRBbU51TVJFd0R3WURWUVFJREFoemFHRnVaMmhoYVRFUk1BOEdBMVVFQnd3SQpjMmhoYm1kb1lXa3hFakFRQmdOVkJBb01DWE53YVdSbGNtNWxkREVTTUJBR0ExVUVDd3dKYzNCcFpHVnlibVYwCk1SSXdFQVlEVlFRRERBbHpjR2xrWlhKdVpYUXdnZ0VpTUEwR0NTcUdTSWIzRFFFQkFRVUFBNElCRHdBd2dnRUsKQW9JQkFRQzFkbjJvZlZPWUZ0dldXNlQ1YTRQU0dGdWNnVG5VUXZCaEhibFNYUFJqQVhqbC9aWm1xdXhaVy9GbQo3ZGRmRC9uSk1CSkdWaThtaFl6Tm1JM3p3STJxb0FCLzJKZlpRaGltNk5kb1lrcmJPcjZ5djBVN1l1QmtDQXQzCnNhNkUwQXp3OHNINGdwMzZJajR0Y3NFTGN5Y241aHhjUk9uSE4zbG4rdE1VcXBraEdmQ25WeTBMWFdsRVhYVU8KQ1E5akp0SnVyZG5GTUg4d0VqeDdpdmppRlY1SUMwOUkwT28wTStudWUreHR0QnVEenI0R0pFdTMyaW1GU002VgpYL2xwUDlXbGNOREJCaTFGNjUxeDZVNE5WbW53b054Wkpvb3dKMlVFNlEzckluNjVXOS92UVVoN3VhbzdQbEZXCnl6bDF2djlTVE91MGRjRDZFanZwVUdwOGVpTWxBZ01CQUFHalV6QlJNQjBHQTFVZERnUVdCQlNWc2hGZTRXdUkKRUUwTVoveXhDWGlZcmRhVnR6QWZCZ05WSFNNRUdEQVdnQlNWc2hGZTRXdUlFRTBNWi95eENYaVlyZGFWdHpBUApCZ05WSFJNQkFmOEVCVEFEQVFIL01BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQ2YwUEZmYmR0SWRia1NIODFHCmFkNjQ0M2ZBS2dCV0xnSHAvQmFCWklYblN6U29TMklSR1lGTzRyTXhhTkoydWc0Q1NTSjE1UWJscFZEWk9xazYKdEQ3MHk5eUNZS2dNVlRVTE1zOHRtcTcxSTBqWHkxaHd5bWIvMGdwK0Y3NDRzNDBQWWlsVi9LKzBWWmtkR0dUMAovQ2drU3ArMVF6V1hlMVh3Q0VHUW9UbG1NNHlNdk9qdXVZZHJ4cDVMNmtEY29hK2dhVUZKNVpBZkFtdHNwd3J0CmEvM2Q5UjBIQUcrbFYwQnBtdEI3YmlRdndlMXFKSTdxMFNSVzdUUGg2T0FDQWtPdnN0aElab2dlaDNNZmFNY00KSFU5NFN2MEFWSlNEN1cwVWsrOU9HMXR1SGhHb3pqR2liRGN6NTFjelhTWG5UN1phdDVtbDFCNXBGaG9WYkRQWgpzczd0Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K"
  key: "LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpQcm9jLVR5cGU6IDQsRU5DUllQVEVECkRFSy1JbmZvOiBERVMtRURFMy1DQkMsNUM3QkY4ODM0MzU2MjM0MQoKczYwV2dHQWFNSEcxOG56NExZOFA5N1hkU2E3YUIzNnJDYzM4ZUZBdlY1Yk92RWRUSWRXS09hUk1XV3pDWmxHTQpLTUVCdmM3dE1HdXMvdGIvc3Z4R1JaQnBXMmpZTkwwQmN5Qk4xNmZya3E3NnVuMFRZcHYvR0Q5dHdJcnFla2dxCkhPN01zeTdvWklWd2tLdVR6V2RBZGRFNUxLQmM1d0xaaHFNZWh4bFVtVVlxNEtub1orY0Ftc0poR2htTTlmdlMKU0g2TVJReEFtOGxhMnAzckJNUm10Q0kvekJ4WDdkWVh4ME11Y0VEVERXNERVbE9UVXFHZDZnRWduQmIwdXJlTAovUWxMSlZmQ1ovL29sODhvbEJFV25aWEtFOXNKUTNBd0lvRjFFVVNoMjhlYWgzdnhkSlc5SjB6RU5VU3VhbkYxCkV3M05CdlFlL2E3Y1J0Rm1mS1RFK0h3VzlLSkJsNTR1QUxmWHVrUnpBZVhZU1hyc09JQVBOa04wbDFIVnhiYlgKWTVHODQyaHduWlZNaEE5THNLU0xyNC9PRzdOOXlmUEljNWprb1Vxb3pmaVJRN0V6TkN5TnllMzZwWG5GNHY5MwpSdXU3NzM1aWxnb1lxRjZOYkJ0OHlPalI5aEVlYVdTV0ZoeUQvRklCVnh4VURtN0M3SmoxNU9vSXZjL1FuQStXCjFscThaeVU2dUU2MnlYNklPeVA3WVFqQ2NGUXdMNUt0SmpZVngyblUyeHFEK0tvU0doRitlWjJMUVVoVkx4ZWYKNXU2VHlQMFBJSEY0bVlIeGlrSm5reEVZem5FY1NnU0UvWlIvR0hKNCt5OGVobStWblFSK3lyNXB5UGFaTU1udgpvVmJ0YW9nTzNTeU1oRk1UR09PUkxuL3M1eG5aaVFOeFAvTjc0RzlFSU1aWHRSL3dhTWdCbW1ybVZKdENrQkQ1CndnSU9WZFdCS2VLdS8wbThTTHQzSmpzOE12WitkeDN5K0cyKzZCQXVSK2NTUTA1OGdqUFpaMDJHd0I0QVpBNy8KN2Z4K3RZQmowRHY2emFwRnpwQzFwVzJWVHFaRmIrd1lyaWd0YmVITkVvQlZxWUYrOWRZbjlqaDljMExaL2RsNAoySGRQQllNT20vVmZPdmZrcGtYRVUzNXUwQmoyTkcrQlM2VjljOUNGM05lVStzUU50aUhjZmxzbTQ4cDYxSG4vCkhSaEJKNGdZTXRHZEdLRHhNTWc5dFN5ZWQvV1MvOHo5dTF6T0Y2NmRkL3ZJa1pzNmhERG90emY3TnJEK0tiNlIKVTdLaklNMWhBSTBFRVh0WStwTnczdlZOMGErWGlzQXh1cThzVHdmblFiNFRTbzE3eENXWlJWcWh5UUdEY0tOSQpGTUY3WVc5bTJSNDZ6MEwvaGdMVU1yWEkyVUlRZmc3Z1kzemJDUmxOek9DSkNkMmo5aEk2SmZzVlhURzB0YlBCCllpZ2xXM25ocjd6UHZYNW9kZ1QxMm5mYWJLcHlCQXk2SWZkNy96UHcySzFjSndJckZVNWlJM25MSk1WdFNOMUMKZEhhZnIzeWtYa01oTk9mUVdyaUJQUVFrOG56OW91RDdMT3NaUWtFSHo4bkwrOXhiaC9ldnVvY3JNYlh2aVFFKwpWby9vZm9oRHFpQkc2U09QOTJ6RUJmNDVOZEloWnF1ZVZMSFk5Z3A0eW51bTQ2N3lmZ0t5Q0pVRG9tRTRCYnZsCmgrVWRIZjlGZDBrc1Z5Vm00UE8wSjVPOGNseUR2RjEzaWZDTkI1YXM2YmhtMEx3OEU5Nnc1OEJxQ3YrNzN3M2QKZXl2NDl5R25TSkdZdlR4ZE1IdlYyaW9hOEtBK3hnSlA1NjBFOVkyQ0ZrNS9vK0JDaUtXY2ltTDF6UFFSalpTeApEcjFuS3d2OE5KWkdsY2NGdHhXVTZkNjNGbm5nNkRFd1hzUWdZRm92OVBoczlTaHN5WjRxZGlpMG51NHh0TzlpCmVaN1c5cGZvMndBZnZ0eUZQdTlGWUw5YmRiS0MySXlqN3pNbVozUkVRdkxBTjVhdzhXa2M3dEU1OVJ1THVZY2IKcmVLZUlYNzNhbFJLKytPWDFqdEEwaDRwZHVwTTF2azFIK2FMSnJCa2FEZXVpcG5BL29MbWhnPT0KLS0tLS1FTkQgUlNBIFBSSVZBVEUgS0VZLS0tLS0K"

ipamPlugin:
  # -- Configure the log file for IPAM
  log_file_path: /var/run/spidernet/spiderpool.log
  log_file_max_size: 100M
  log_file_max_age: 30d
  log_file_max_count: 7
  log_level: "INFO"

  # -- Configure the path to the configuration directory on the host.
  confPath: /etc/cni/net.d/spiderpool

  binPath: /opt/cni/bin

  # -- Configure the path to the binary directory on the host.
  ipamBinPath: /opt/cni/bin

  # -- Configure the unix socket path to connect with the spiderpool agent.
  ipam_unix_socket_dir: /var/run/spidernet
  ipam_unix_socket_path: /var/run/spidernet/spiderpool.sock

configmap:
  configCmName: "spiderpool-conf"
  config:
    # -- Unix domain socket path to listen for ipam plugin.
    ipamUnixSocketPath: "/var/run/spidernet/spiderpool.sock"
    enableIpv4: true
    enableIpv6: true
    clusterDefaultIpv4Ippool: []
    clusterDefaultIpv6Ippool: []
    networkMode: "legacy"

spiderpoolAgent:
  name: "spiderpool-agent"

  binName: "spiderpool-agent"

  image:
    repository: ghcr.io/spidernet-io/spiderpool/spiderpool-agent
    pullPolicy: IfNotPresent
    # take preference over tag
    digest: ""
    # Overrides the image tag whose default is the chart appVersion.
    tag: ""
    imagePullSecrets: []
    # - name: "image-pull-secret"

  nodeSelector:
    kubernetes.io/os: linux

  nameOverride: ""

  serviceAccount:
    create: true
    annotations: {}

  updateStrategy:
    rollingUpdate:
      maxUnavailable: 2
    type: RollingUpdate

  service:
    # Optional annotations to add to the Service
    annotations: {}
    type: ClusterIP

  # -- Node tolerations
  # ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/
  tolerations:
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
    - effect: NoSchedule
      key: node.kubernetes.io/disk-pressure
      operator: Exists
    - effect: NoSchedule
      key: node.kubernetes.io/memory-pressure
      operator: Exists
    - effect: NoSchedule
      key: node.kubernetes.io/pid-pressure
      operator: Exists
    - effect: NoSchedule
      key: node.kubernetes.io/unschedulable
      operator: Exists
    - effect: NoSchedule
      key: node.kubernetes.io/network-unavailable
      operator: Exists
    - key: node.kubernetes.io/not-ready
      effect: NoSchedule
    - key: node-role.kubernetes.io/master
      effect: NoSchedule
    - key: CriticalAddonsOnly
      operator: Exists

  priorityClassName: ""

  affinity: {}

  # -- Additional container arguments.
  extraArgs: []

  # -- Additional container environment variables.
  extraEnv: []

  # -- Additional agent hostPath mounts.
  extraHostPathMounts: []
    # - name: host-mnt-data
    #   mountPath: /host/mnt/data
    #   hostPath: /mnt/data
    #   hostPathType: Directory
    #   readOnly: true
    #   mountPropagation: HostToContainer

  # -- Additional agent volumes.
  extraVolumes: []

  # -- Additional agent volumeMounts.
  extraVolumeMounts: []

  # -- Annotations to be added to agent pods
  podAnnotations: {}

  # -- Labels to be added to agent pods
  podLabels: {}

  # -- Configure the path to where to mount the ConfigMap inside the agent pod.
  confFileMountPath: /tmp/cni-configuration

  resources: {}
    # We usually recommend not to specify default resources and to leave this as a conscious
    # choice for the user. This also increases chances charts run on environments with little
    # resources, such as Minikube. If you do want to specify resources, uncomment the following
    # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
    # limits:
    #   cpu: 1000m
    #   memory: 512Mi
    # requests:
    #   cpu: 100m
    #   memory: 128Mi

  # -- Security context to be added to agent pods
  securityContext: {}
  # runAsUser: 0

  # -- Configure the path to where the CNI configuration directory is mounted
  # inside the agent pod.
  hostConfDirMountPath: /host/etc/cni/net.d/spiderpool

  # -- http Port for health checking
  httpPort: "5710"

  healthChecking:
    startupProbe:
      # -- failure threshold of startup probe.
      # 105 x 2s translates to the old behaviour of the readiness probe (120s delay + 30 x 3s)
      failureThreshold: 60
      # -- interval between checks of the startup probe
      periodSeconds: 2

    livenessProbe:
      # -- failure threshold of liveness probe
      failureThreshold: 6
      # -- interval between checks of the liveness probe
      periodSeconds: 10

    readinessProbe:
      # -- failure threshold of readiness probe
      failureThreshold: 3
      # -- interval between checks of the readiness probe
      periodSeconds: 10

  # -- Enable prometheus metrics for cilium-operator on the configured port at
  # /metrics
  prometheus:
    # -- Enable service monitors.
    # This requires the prometheus CRDs to be available (see https://github.com/prometheus-operator/prometheus-operator/blob/master/example/prometheus-operator-crd/monitoring.coreos.com_servicemonitors.yaml)
    enabled: false
    port: 5711
    serviceMonitor:
      labels: {}
      annotations: {}
    prometheusRule:
      # enable alter rules
      enabled: false

  debug:
    logLevel: "INFO"
    pprofEnabled: false

spiderpoolController:
  name: "spiderpool-controller"

  replicas: 1

  binName: "spiderpool-controller"

  # ippool is not installed when installation , so have to be hostnetwork
  hostnetwork: true

  nameOverride: ""

  image:
    repository: ghcr.io/spidernet-io/spiderpool/spiderpool-controller
    pullPolicy: IfNotPresent
    # take preference over tag
    digest: ""
    # digest: "sha256:251ff274acf22fd2067b29a31e9fda94253d2961c061577203621583d7e85bd2"
    # Overrides the image tag whose default is the chart appVersion.
    tag: ""
    imagePullSecrets: []
    # - name: "image-pull-secret"

  nodeSelector:
    kubernetes.io/os: linux

  affinity: {}

  serviceAccount:
    create: true
    name: ""
    annotations: {}

  service:
    # Optional annotations to add to the Service
    annotations: {}
    type: ClusterIP

  tolerations:
    - key: CriticalAddonsOnly
      operator: Exists
    - effect: NoSchedule
      key: node-role.kubernetes.io/master
    - effect: NoExecute
      key: node.kubernetes.io/not-ready
      operator: Exists
      tolerationSeconds: 300
    - effect: NoExecute
      key: node.kubernetes.io/unreachable
      operator: Exists
      tolerationSeconds: 300

  priorityClassName: ""

  # -- Additional container arguments.
  extraArgs: []

  # -- Additional container environment variables.
  extraEnv: []

  # -- Additional agent hostPath mounts.
  extraHostPathMounts: []
    # - name: host-mnt-data
    #   mountPath: /host/mnt/data
    #   hostPath: /mnt/data
    #   hostPathType: Directory
    #   readOnly: true
  #   mountPropagation: HostToContainer

  # -- Additional agent volumes.
  extraVolumes: []
    # - name: test-val
    #   mountPath: /host/tmp

  # -- Additional agent volumeMounts.
  extraVolumeMounts: []
    # - name: test-val
    #   mountPath: /tmp

  # -- Annotations to be added to agent pods
  podAnnotations: {}
    # test: 100

  # -- Labels to be added to agent pods
  podLabels: {}

  # -- security context
  securityContext: {}
  # runAsUser: 0

  resources:
    # We usually recommend not to specify default resources and to leave this as a conscious
    # choice for the user. This also increases chances charts run on environments with little
    # resources, such as Minikube. If you do want to specify resources, uncomment the following
    # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi

  # -- http Port to listen to for CLI and health checking
  httpPort: "5720"

  # PodDisruptionBudget settings
  podDisruptionBudget:
    # -- enable PodDisruptionBudget
    # ref: https://kubernetes.io/docs/concepts/workloads/pods/disruptions/
    enabled: false
    # -- Minimum number/percentage of pods that should remain scheduled.
    # When it's set, maxUnavailable must be disabled by `maxUnavailable: null`
    minAvailable: 1
    # -- Maximum number/percentage of pods that may be made unavailable
   # maxUnavailable: 1

  healthChecking:
    startupProbe:
      # -- failure threshold of startup probe.
      # 105 x 2s translates to the old behaviour of the readiness probe (120s delay + 30 x 3s)
      failureThreshold: 30
      # -- interval between checks of the startup probe
      periodSeconds: 2

    livenessProbe:
      # -- failure threshold of liveness probe
      failureThreshold: 6
      # -- interval between checks of the liveness probe
      periodSeconds: 10

    readinessProbe:
      # -- failure threshold of readiness probe
      failureThreshold: 3
      # -- interval between checks of the readiness probe
      periodSeconds: 10

  # -- Enable prometheus metrics for cilium-operator on the configured port at
  # /metrics
  prometheus:
    enabled: false
    port: 5721
    serviceMonitor:
      # -- Enable service monitors.
      # This requires the prometheus CRDs to be available (see https://github.com/prometheus-operator/prometheus-operator/blob/master/example/prometheus-operator-crd/monitoring.coreos.com_servicemonitors.yaml)
      enabled: false
      labels: {}
      annotations: {}
    prometheusRule:
      # enable alter rules
      enabled: false

  debug:
    logLevel: "INFO"
    pprofEnabled: false

  gc:
    # global enable
    enabled: true
    # if enabled=false, ignore this
    gcTerminatingPodIpEnabled: true
    # delay to gc pod ip after pod graceful time, second
    gcTerminatingPodIpDelay: 0
    # if enabled=false, ignore this
    gcEvictedPodIpEnabled: true
    # delay to gc pod ip after pod graceful time, second
    gcEvictedPodIpDelay: 0

  # -- TLS configuration for webhook
  tls:
    # -- Set the method to auto-generate certificates. Supported values:
    # - helm:         This method uses Helm to generate all certificates.
    # - provided:     provide all certificates by helm options
    # - certmanager:  This method use cert-manager to generate & rotate certificates.
    method: provided

    # -- Generated certificates validity duration in days.
    certValidityDuration: 1095

    # If not specified, a CA issuer will be created.
    # used by method certmanager
    certManagerIssuerName: ""

    # -- base64 encoded PEM values for the Hubble server certificate and private key
    server:
      # used by method provided
      # encoded
      cert: ""
      key: ""
      # -- Extra DNS names added to certificate when it's auto generated
      extraDnsNames: []
      # -- Extra IP addresses added to certificate when it's auto generated
      extraIpAddresses: []

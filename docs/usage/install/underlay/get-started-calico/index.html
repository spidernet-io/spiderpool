
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Calico Quick Start - spiderpool</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#calico-quick-start" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="spiderpool" class="md-header__button md-logo" aria-label="spiderpool" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            spiderpool
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Calico Quick Start
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/spidernet-io/spiderpool" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    spidernet-io/spiderpool
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="spiderpool" class="md-nav__button md-logo" aria-label="spiderpool" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    spiderpool
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/spidernet-io/spiderpool" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    spidernet-io/spiderpool
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        Spiderpool
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Installation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Installation" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Installation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../install.md" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../upgrade/" class="md-nav__link">
        Upgrading
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../certificate/" class="md-nav__link">
        Certificates
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Usage
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Usage" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Usage
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../spider-subnet/" class="md-nav__link">
        SpiderSubnet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ippool-namespace/" class="md-nav__link">
        Default IPPool at namespace
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ippool-multi/" class="md-nav__link">
        Back up IPPool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ippool-affinity-namespace/" class="md-nav__link">
        Namespace affinity of IPPool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ippool-affinity-node/" class="md-nav__link">
        Node affinity of IPPool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ippool-affinity-pod/" class="md-nav__link">
        Pod affinity of IPPool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../ipv6/" class="md-nav__link">
        IPv6 support
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../statefulset/" class="md-nav__link">
        StatefulSet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../reserved-ip/" class="md-nav__link">
        Reserved IP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../third-party-controller/" class="md-nav__link">
        Third-party controllers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../gc/" class="md-nav__link">
        Reclaim IP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../route/" class="md-nav__link">
        Route support
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../performance/" class="md-nav__link">
        Spiderpool Performance Testing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../debug/" class="md-nav__link">
        FAQ
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Concepts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Concepts" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Concepts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/annotation/" class="md-nav__link">
        Annotations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/arch/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/config/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/allocation/" class="md-nav__link">
        IP Allocation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/metrics/" class="md-nav__link">
        Metrics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/gc/" class="md-nav__link">
        Resource Reclaim
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/spiderendpoint/" class="md-nav__link">
        SpiderEndpoint
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/spiderippool/" class="md-nav__link">
        SpiderIPPool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/spiderreservedip/" class="md-nav__link">
        SpiderReservedIP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/spidersubnet/" class="md-nav__link">
        SpiderSubnet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/solution/" class="md-nav__link">
        Underlay and overlay solutions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          CLI Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="CLI Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          CLI Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cmdref/spiderpoolctl/" class="md-nav__link">
        spiderpoolctl
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cmdref/spiderpool-controller/" class="md-nav__link">
        spiderpool-controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cmdref/spiderpool-agent/" class="md-nav__link">
        spiderpool-agent
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Development
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Development" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../develop/contributing/" class="md-nav__link">
        Contribution Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../develop/contributing/" class="md-nav__link">
        Code of Conduct
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../develop/release/" class="md-nav__link">
        Release workflow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../develop/roadmap/" class="md-nav__link">
        Roadmap
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../develop/swagger_openapi/" class="md-nav__link">
        Swagger OpenAPI
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-spiderpool" class="md-nav__link">
    Install Spiderpool
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-calico-bgp-optional" class="md-nav__link">
    Configure Calico BGP [optional]
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-calico-ip-pool-in-the-same-subnet" class="md-nav__link">
    Create a Calico IP pool in the same subnet
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#switch-calicos-ipam-to-spiderpool" class="md-nav__link">
    Switch Calico's IPAM to Spiderpool
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-applications" class="md-nav__link">
    Create applications
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
  



  <a href="https://github.com/spidernet-io/spiderpool/edit/master/docs/usage/install/underlay/get-started-calico.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="calico-quick-start">Calico Quick Start</h1>
<p><strong>English</strong> | <a href="../get-started-calico-zh_CN/"><strong>简体中文</strong></a></p>
<p>Spiderpool is able to provide static IPs to Deployments, StatefulSets, and other types of applications in underlay networks. In this page, we'll introduce how to build a complete Underlay network environment in Calico + BGP mode, and integrate it with Spiderpool to enable fixed IP addresses for applications. This solution meets the following requirements:</p>
<ul>
<li>
<p>Assign static IP addresses to applications</p>
</li>
<li>
<p>Scale IP pools dynamically based on replica counts</p>
</li>
<li>
<p>Enable external clients outside the cluster to access applications without their IPs</p>
</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>
<p>An available <strong><em>Kubernetes</em></strong> cluster with a recommended version higher than 1.22, where <strong><em>Calico</em></strong> is installed as the default CNI.</p>
<p>Make sure that Calico is not configured to use IPIP or VXLAN tunneling as we'll demonstrate how to use Calico for underlay networks.</p>
<p>Confirm that Calico has enabled BGP configuration in full-mesh mode。</p>
</li>
<li>
<p>Helm and Calicoctl</p>
</li>
</ul>
<h2 id="install-spiderpool">Install Spiderpool</h2>
<div class="highlight"><pre><span></span><code>helm repo add spiderpool https://spidernet-io.github.io/spiderpool
helm install spiderpool spiderpool/spiderpool --namespace kube-system 
</code></pre></div>
<blockquote>
<p>Spiderpool is IPv4-Only by default. If you want to enable IPv6, refer to <a href="https://github.com/spidernet-io/spiderpool/blob/main/docs/usage/ipv6.md">Spiderpool IPv6</a>.</p>
<p>If you are mainland user who is not available to access ghcr.io，You can specify the parameter <code>-set global.imageRegistryOverride=ghcr.m.daocloud.io</code> to avoid image pulling failures for Spiderpool.</p>
</blockquote>
<p>Create a subnet for a Pod (SpiderSubnet):</p>
<div class="highlight"><pre><span></span><code>cat <span class="s">&lt;&lt; EOF | kubectl apply -f -</span>
<span class="s">apiVersion: spiderpool.spidernet.io/v2beta1</span>
<span class="s">kind: SpiderSubnet</span>
<span class="s">metadata:</span>
<span class="s">  name: nginx-subnet-v4</span>
<span class="s">  labels:  </span>
<span class="s">    ipam.spidernet.io/subnet-cidr: 10-244-0-0-16</span>
<span class="s">spec:</span>
<span class="s">  ips:</span>
<span class="s">  - 10.244.100.0-10.244.200.1</span>
<span class="s">  subnet: 10.244.0.0/16</span>
<span class="s">EOF</span>
</code></pre></div>
<p>Verify the installation：</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># kubectl get po -n kube-system  | grep spiderpool</span>
spiderpool-agent-27fr2                     <span class="m">1</span>/1     Running     <span class="m">0</span>          2m
spiderpool-agent-8vwxj                     <span class="m">1</span>/1     Running     <span class="m">0</span>          2m
spiderpool-controller-bc8d67b5f-xwsql      <span class="m">1</span>/1     Running     <span class="m">0</span>          2m

<span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># kubectl get ss</span>
NAME              VERSION   SUBNET          ALLOCATED-IP-COUNT   TOTAL-IP-COUNT
nginx-subnet-v4   <span class="m">4</span>         <span class="m">10</span>.244.0.0/16   <span class="m">0</span>                    <span class="m">25602</span>
</code></pre></div>
<h2 id="configure-calico-bgp-optional">Configure Calico BGP [optional]</h2>
<p>In this example, we want Calico to work in underlay mode and announce the Spiderpool subnet (<code>10.244.0.0/16</code>) to the BGP router via the BGP protocol, ensuring that clients outside the cluster can directly access the real IP addresses of the Pods through BGP router.</p>
<blockquote>
<p>If you don't need external clients to access pod IPs directly, skip this step.</p>
</blockquote>
<p>The network topology is as follows:</p>
<p><img alt="calico-bgp" src="../images/calico-bgp.svg" /></p>
<ol>
<li>
<p>Configure a host outside the cluster as BGP Router</p>
<p>We will use an Ubuntu server as BGP Router. FRR needs to be installed beforehand:</p>
<div class="highlight"><pre><span></span><code>root@router:~# apt install -y frr
</code></pre></div>
<p>FRR enable BGP:</p>
<div class="highlight"><pre><span></span><code>root@router:~# sed -i <span class="s1">&#39;s/bgpd=no/bgpd=yes/&#39;</span> /etc/frr/daemons
root@router:~# systemctl restart frr
</code></pre></div>
<p>Configure FRR:</p>
<div class="highlight"><pre><span></span><code>root@router:~# vtysh
router# config
router<span class="o">(</span>config<span class="o">)</span><span class="c1"># router bgp 23000 </span>
router<span class="o">(</span>config<span class="o">)</span><span class="c1"># bgp router-id 172.16.13.1 </span>
router<span class="o">(</span>config<span class="o">)</span><span class="c1"># neighbor 172.16.13.11 remote-as 64512 </span>
router<span class="o">(</span>config<span class="o">)</span><span class="c1"># neighbor 172.16.13.21 remote-as 64512  </span>
router<span class="o">(</span>config<span class="o">)</span><span class="c1"># no bgp ebgp-requires-policy </span>
</code></pre></div>
<blockquote>
<p>Configuration descriptions:</p>
<ul>
<li>The AS on the router side is <code>23000</code>, and the AS on the cluster node side is <code>64512</code>. The BGP neighbor relationship between the router and the node is ebgp, while the relationship between the nodes is ibgp.</li>
<li><code>ebgp-requires-policy</code> needs to be disabled, otherwise the BGP session cannot be established.</li>
<li>172.16.13.11/21 is the IP address of the cluster node.</li>
</ul>
<p>For more information, refer to <a href="https://docs.frrouting.org/en/latest/bgp.html">frrouting</a>.</p>
</blockquote>
</li>
<li>
<p>Configure BGP neighbor for Calico</p>
<p><code>calico_backend: bird</code> needs to be configured to establish a BGP session:</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span>root@master1 ~<span class="o">]</span><span class="c1"># kubectl get cm -n kube-system calico-config -o yaml</span>
apiVersion: v1
data:
  calico_backend: bird
  cluster_type: kubespray,bgp
kind: ConfigMap
metadata:
  annotations:
    kubectl.kubernetes.io/last-applied-configuration: <span class="p">|</span>
      <span class="o">{</span><span class="s2">&quot;apiVersion&quot;</span>:<span class="s2">&quot;v1&quot;</span>,<span class="s2">&quot;data&quot;</span>:<span class="o">{</span><span class="s2">&quot;calico_backend&quot;</span>:<span class="s2">&quot;bird&quot;</span>,<span class="s2">&quot;cluster_type&quot;</span>:<span class="s2">&quot;kubespray,bgp&quot;</span><span class="o">}</span>,<span class="s2">&quot;kind&quot;</span>:<span class="s2">&quot;ConfigMap&quot;</span>,<span class="s2">&quot;metadata&quot;</span>:<span class="o">{</span><span class="s2">&quot;annotations&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;calico-config&quot;</span>,<span class="s2">&quot;namespace&quot;</span>:<span class="s2">&quot;kube-system&quot;</span><span class="o">}}</span>
creationTimestamp: <span class="s2">&quot;2023-02-26T15:16:35Z&quot;</span>
name: calico-config
namespace: kube-system
resourceVersion: <span class="s2">&quot;2056&quot;</span>
uid: 001bbd09-9e6f-42c6-9339-39f71f81d363
</code></pre></div>
<p>In this example, the default route for the node is on BGP router. As a result, nodes simply need to synchronize their local routes with BGP Router without synchronizing them with each other. Consequently, <em>Calico BGP Full-Mesh</em> needs to be disabled:</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span>root@master1 ~<span class="o">]</span><span class="c1"># calicoctl patch bgpconfiguration default -p &#39;{&quot;spec&quot;: {&quot;nodeToNodeMeshEnabled&quot;: false}}&#39;</span>
</code></pre></div>
<p>Create BGPPeer:</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span>root@master1 ~<span class="o">]</span><span class="c1"># cat &lt;&lt; EOF | calicoctl apply -f -</span>
apiVersion: projectcalico.org/v3
kind: BGPPeer
metadata:
  name: my-global-peer
spec:
  peerIP: <span class="m">172</span>.16.13.1
  asNumber: <span class="m">23000</span>
EOF
</code></pre></div>
<blockquote>
<p>peerIP is the IP address of BGP Router</p>
<p>asNumber is the AS number of BGP Router</p>
</blockquote>
<p>Check if the BGP session is established:</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span>root@master1 ~<span class="o">]</span><span class="c1"># calicoctl node status</span>
Calico process is running.

IPv4 BGP status
+--------------+-----------+-------+------------+-------------+
<span class="p">|</span> PEER ADDRESS <span class="p">|</span> PEER TYPE <span class="p">|</span> STATE <span class="p">|</span>   SINCE    <span class="p">|</span>    INFO     <span class="p">|</span>
+--------------+-----------+-------+------------+-------------+
<span class="p">|</span> <span class="m">172</span>.16.13.1  <span class="p">|</span> global    <span class="p">|</span> up    <span class="p">|</span> <span class="m">2023</span>-03-15 <span class="p">|</span> Established <span class="p">|</span>
+--------------+-----------+-------+------------+-------------+

IPv6 BGP status
No IPv6 peers found.
</code></pre></div>
<p>For more information on Calico BGP configuration, refer to <a href="https://docs.tigera.io/calico/3.25/networking/configuring/bgp">Calico BGP</a>.</p>
</li>
</ol>
<h2 id="create-a-calico-ip-pool-in-the-same-subnet">Create a Calico IP pool in the same subnet</h2>
<p>Create a Calico IP pool with the same CIDR as the Spiderpool subnet, otherwise Calico won't advertise the route of the Spiderpool subnet:</p>
<div class="highlight"><pre><span></span><code>cat <span class="s">&lt;&lt; EOF | calicoctl apply -f -</span>
<span class="s">apiVersion: projectcalico.org/v3</span>
<span class="s">kind: IPPool</span>
<span class="s">metadata:</span>
<span class="s">  name: spiderpool-subnet</span>
<span class="s">spec:</span>
<span class="s">  blockSize: 26</span>
<span class="s">  cidr: 10.244.0.0/16</span>
<span class="s">  ipipMode: Never</span>
<span class="s">  natOutgoing: false</span>
<span class="s">  nodeSelector: all()</span>
<span class="s">  vxlanMode: Never</span>
<span class="s">EOF</span>
</code></pre></div>
<blockquote>
<p>The CIDR needs to correspond to the subnet of Spiderpool: <code>10.244.0.0/16</code></p>
<p>Set ipipMode and vxlanMode to: Never</p>
</blockquote>
<h2 id="switch-calicos-ipam-to-spiderpool">Switch Calico's <code>IPAM</code> to Spiderpool</h2>
<p>Change the Calico CNI configuration file  <code>/etc/cni/net.d/10-calico.conflist</code> on each node to switch the ipam field to Spiderpool:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&quot;ipam&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;spiderpool&quot;</span><span class="w"></span>
<span class="p">},</span><span class="w"></span>
</code></pre></div>
<h2 id="create-applications">Create applications</h2>
<p>Take the Nginx application as an example:</p>
<div class="highlight"><pre><span></span><code>cat <span class="s">&lt;&lt;EOF | kubectl create -f -</span>
<span class="s">apiVersion: apps/v1</span>
<span class="s">kind: Deployment</span>
<span class="s">metadata:</span>
<span class="s">  name: nginx</span>
<span class="s">spec:</span>
<span class="s">  replicas: 2</span>
<span class="s">  selector:</span>
<span class="s">    matchLabels:</span>
<span class="s">      app: nginx</span>
<span class="s">  template:</span>
<span class="s">    metadata:</span>
<span class="s">      annotations:</span>
<span class="s">        ipam.spidernet.io/subnet: &#39;{&quot;ipv4&quot;:[&quot;nginx-subnet-v4&quot;]}&#39;</span>
<span class="s">        ipam.spidernet.io/ippool-ip-number: &#39;+3&#39;</span>
<span class="s">      labels:</span>
<span class="s">        app: nginx</span>
<span class="s">    spec:</span>
<span class="s">      containers:</span>
<span class="s">      - name: nginx</span>
<span class="s">        image: nginx</span>
<span class="s">        imagePullPolicy: IfNotPresent</span>
<span class="s">        ports:</span>
<span class="s">        - name: http</span>
<span class="s">          containerPort: 80</span>
<span class="s">          protocol: TCP</span>
<span class="s">EOF</span>
</code></pre></div>
<blockquote>
<p><code>ipam.spidernet.io/subnet</code>: Assign static IPs from "nginx-subnet-v4" SpiderSubnet</p>
<p><code>ipam.spidernet.io/ippool-ip-number</code>: '+3' means the number of static IPs allocated to the application is three more than the number of its replicas, guaranteeing available temporary IPs during application rolling updates.</p>
</blockquote>
<p>When a Pod is created, Spiderpool automatically creates an IP pool named <code>auto-nginx-v4-eth0-452e737e5e12</code> from <code>subnet: nginx-subnet-v4</code> specified in the annotations and binds it to the Pod. The IP range is <code>10.244.100.90-10.244.100.95</code>, and the number of IPs in the pool is <code>5</code>:</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span>root@master1 ~<span class="o">]</span><span class="c1"># kubectl get sp</span>
NAME                              VERSION   SUBNET          ALLOCATED-IP-COUNT   TOTAL-IP-COUNT   DEFAULT   DISABLE
auto-nginx-v4-eth0-452e737e5e12   <span class="m">4</span>         <span class="m">10</span>.244.0.0/16   <span class="m">2</span>                    <span class="m">5</span>                <span class="nb">false</span>     <span class="nb">false</span>

<span class="o">[</span>root@master ~<span class="o">]</span><span class="c1"># kubectl get sp auto-nginx-v4-eth0-452e737e5e12 -o jsonpath=&#39;{.spec.ips}&#39; </span>
<span class="o">[</span><span class="s2">&quot;10.244.100.90-10.244.100.95&quot;</span><span class="o">]</span>
</code></pre></div>
<p>When the replicas restart, its IP is fixed within the IP pool range of <code>auto-nginx-v4-eth0-452e737e5e12</code>:</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span>root@master1 ~<span class="o">]</span><span class="c1"># kubectl get po -o wide</span>
NAME                     READY   STATUS        RESTARTS   AGE     IP              NODE      NOMINATED NODE   READINESS GATES
nginx-644659db67-szgcg   <span class="m">1</span>/1     Running       <span class="m">0</span>          23s     <span class="m">10</span>.244.100.90    worker5   &lt;none&gt;           &lt;none&gt;
nginx-644659db67-98rcg   <span class="m">1</span>/1     Running       <span class="m">0</span>          23s     <span class="m">10</span>.244.100.92    master1   &lt;none&gt;           &lt;none&gt;
</code></pre></div>
<p>When the replica count increases to <code>3</code>, the IP address of the new replica is still assigned from the automatic pool: <code>auto-nginx-v4-eth0-452e737e5e12(10.244.100.90-10.244.100.95)</code></p>
<div class="highlight"><pre><span></span><code><span class="o">[</span>root@master1 ~<span class="o">]</span><span class="c1"># kubectl scale deploy nginx --replicas 3  # scale pods</span>
deployment.apps/nginx scaled

<span class="o">[</span>root@master1 ~<span class="o">]</span><span class="c1"># kubectl get po -o wide</span>
NAME                     READY   STATUS        RESTARTS   AGE     IP              NODE      NOMINATED NODE   READINESS GATES
nginx-644659db67-szgcg   <span class="m">1</span>/1     Running       <span class="m">0</span>          1m     <span class="m">10</span>.244.100.90    worker5   &lt;none&gt;           &lt;none&gt;
nginx-644659db67-98rcg   <span class="m">1</span>/1     Running       <span class="m">0</span>          1m     <span class="m">10</span>.244.100.92    master1   &lt;none&gt;           &lt;none&gt;
nginx-644659db67-brqdg   <span class="m">1</span>/1     Running       <span class="m">0</span>          10s    <span class="m">10</span>.244.100.94    master1   &lt;none&gt;           &lt;none&gt;
</code></pre></div>
<p>Check if both <code>ALLOCATED-IP-COUNT</code> and <code>TOTAL-IP-COUNT</code> of the automatic pool <code>auto-nginx-v4-eth0-452e737e5e12</code> increase by 1:</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span>root@master1 ~<span class="o">]</span><span class="c1"># kubectl get sp</span>
NAME                              VERSION   SUBNET          ALLOCATED-IP-COUNT   TOTAL-IP-COUNT   DEFAULT   DISABLE
auto-nginx-v4-eth0-452e737e5e12   <span class="m">4</span>         <span class="m">10</span>.244.0.0/16   <span class="m">3</span>                    <span class="m">6</span>                <span class="nb">false</span>     <span class="nb">false</span>
</code></pre></div>
<h2 id="conclusion">Conclusion</h2>
<p>The test result shows that clients outside the cluster can access Nginx Pods directly via their IP addresses. Nginx Pods can also communicate across cluster nodes, including Calico subnets. In Calico BGP mode, Spiderpool can be integrated with Calico to satisfy the fixed IP requirements for Deployments and other types of applications.</p>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.instant", "navigation.top", "navigation.tracking", "search.highlight", "search.suggest", "search.share"], "search": "../../../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
    
    
  </body>
</html>
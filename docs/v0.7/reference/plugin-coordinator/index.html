<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Coordinatorr plugin - spiderpool</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../css/version-select.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Coordinatorr plugin";
        var mkdocs_page_input_path = "reference/plugin-coordinator.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> spiderpool
        </a>
        <div class="version">
          {'provider': 'mike'}
        </div><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Spiderpool</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Installation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/install/install/">Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Underlay installation</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../usage/install/underlay/get-started-calico/">Calico</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../usage/install/underlay/get-started-weave/">Weave</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../usage/install/underlay/get-started-kind/">Macvlan</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../usage/install/underlay/get-started-ovs/">Ovs</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../usage/install/underlay/get-started-sriov/">SRIOV</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Overlay installation</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../usage/install/overlay/get-started-calico/">Calico</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../usage/install/overlay/get-started-cilium/">Cilium</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Public cloud installation</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../usage/install/cloud/get-started-alibaba/">alibaba cloud</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../usage/install/cloud/get-started-vmware/">vmware vsphere</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../usage/install/cloud/get-started-openstack/">openstack</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/install/upgrade/">Upgrading</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/install/certificate/">Certificates</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Usage</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/spider-subnet/">SpiderSubnet</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/spider-multus-config/">SpiderMultusConfig</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/ippool-namespace/">Default IPPool at namespace</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/multi-interfaces-annotation/">Multiple interfaces</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/ippool-multi/">Backup IPPool</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/ippool-affinity-namespace/">Namespace affinity of IPPool</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/ippool-affinity-node/">Node affinity of IPPool</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/ippool-affinity-pod/">Pod affinity of IPPool</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/ipv6/">IPv6 support</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/statefulset/">StatefulSet</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/reserved-ip/">Reserved IP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/third-party-controller/">Third-party controllers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/gc/">Reclaim IP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/route/">Route support</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/coordinator/">Plugin coordinator</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/ifacer/">Plugin ifacer</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/network-topology/">node-based topology</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/debug/">FAQ</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Concepts</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../concepts/arch/">Architecture</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../concepts/allocation/">IP Allocation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../concepts/metrics/">Metrics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../concepts/multusconfig/">Multus</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../concepts/gc/">Recycle IP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../concepts/solution/">Underlay and overlay solutions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../concepts/performance/">IPAM Performance</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Reference</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../annotation/">Annotations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../configmap/">Configmap</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../spiderpool-controller/">spiderpool-controller</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../spiderpool-agent/">spiderpool-agent</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../crd-spidersubnet/">CRD SpiderSubnet</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../crd-spiderippool/">CRD SpiderIPPool</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../crd-spidermultusconfig/">CRD Spidermultusconfig</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../crd-spidercoordinator/">CRD Spidercoordinator</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../crd-spiderendpoint/">CRD SpiderEndpoint</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../crd-spiderreservedip/">CRD SpiderReservedIP</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Coordinatorr plugin</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#cni-fields-description">CNI fields description</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#configure-examples">Configure Examples</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../plugin-ifacer/">Ifacer plugin</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../plugin-ipam/">IPAM plugin</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Development</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../develop/contributing/">Contribution Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../develop/CODE-OF-CONDUCT/">Code of Conduct</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../develop/release/">Release workflow</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../develop/roadmap/">Roadmap</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../develop/swagger_openapi/">Swagger OpenAPI</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">spiderpool</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
          <li>Reference &raquo;</li>
      <li class="breadcrumb-item active">Coordinatorr plugin</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/spidernet-io/spiderpool/edit/master/docs/reference/plugin-coordinator.md">Edit on spidernet-io/spiderpool</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="meta-plugin-coordinator-configuration">Meta plugin: Coordinator Configuration</h1>
<p>Spiderpool provides a CNI meta-plugin called 'coordinator', which works after the main CNI is called, and provides the following main features:</p>
<ul>
<li>Fixed an issue where Underlay pods could not access ClusterIP</li>
<li>Tune the pod's routing to ensure that packets are routed consistently while a pod is in multi-NIC</li>
<li>Supports detecting if the IP of a pod is in conflict</li>
<li>Supports detecting if the gateway of a pod is reachable</li>
<li>Support for fixing MAC address prefixes for pods</li>
</ul>
<h2 id="cni-fields-description">CNI fields description</h2>
<p>This is a complete manifest file for the coordinator's multus network-attachment-definition:</p>
<blockquote>
<p>'Spidercoordinators default CR' is the global default configuration (all fields) for the 'coordinator' plugin, which has a lower priority than the configuration in NetworkAttachmentDefinition CR. If NetworkAttachmentDefinition CR is not configured, 'Spidercoordinators CR' is used as the default. For more details, see: <a href="../crd-spidercoordinator/">Spidercoordinator</a></p>
</blockquote>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Schema</th>
<th>Validation</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>type</td>
<td>The name of this Spidercoordinators resource</td>
<td>string</td>
<td>required</td>
<td>coordinator</td>
</tr>
<tr>
<td>mode</td>
<td>the mode in which the coordinator run. "auto": Automatically determine if it's overlay or underlay; "underlay": All NICs for pods are underlay NICs, and in this case the coordinator will create veth-pairs device to solve the problem of underlay pods accessing services; "overlay": The coordinator does not create veth-pair devices, but the first NIC of the pod cannot be an underlay NIC, which is created by overlay CNI (e.g. calico, cilium). Solve the problem of pod access to service through the first NIC; "disable": The coordinator does nothing and exits directly</td>
<td>string</td>
<td>optional</td>
<td>auto</td>
</tr>
<tr>
<td>tunePodRoutes</td>
<td>Tune the pod's routing tables while a pod is in multi-NIC mode</td>
<td>bool</td>
<td>optional</td>
<td>true</td>
</tr>
<tr>
<td>podDefaultRouteNic</td>
<td>Configure the default routed NIC for the pod while a pod is in multi-NIC mode</td>
<td>string</td>
<td>optional</td>
<td>""</td>
</tr>
<tr>
<td>podDefaultCniNic</td>
<td>The name of the pod's first NIC defaults to eth0 in kubernetes</td>
<td>bool</td>
<td>optional</td>
<td>eth0</td>
</tr>
<tr>
<td>detectGateway</td>
<td>Enable gateway detection while creating pods, which prevent pod creation if the gateway is unreachable</td>
<td>bool</td>
<td>optional</td>
<td>false</td>
</tr>
<tr>
<td>detectIPConflict</td>
<td>Enable IP conflicting checking for pods, which prevent pod creation if the pod's ip is conflicting</td>
<td>bool</td>
<td>optional</td>
<td>false</td>
</tr>
<tr>
<td>podMACPrefix</td>
<td>Enable fixing MAC address prefixes for pods. empty value is mean to disable</td>
<td>string</td>
<td>optional</td>
<td>""</td>
</tr>
<tr>
<td>overlayPodCIDR</td>
<td>The default cluster CIDR for the cluster. It doesn't need to be configured, and it collected automatically by SpiderCoordinator</td>
<td>[]stirng</td>
<td>optional</td>
<td>[]string{}</td>
</tr>
<tr>
<td>serviceCIDR</td>
<td>The default service CIDR for the cluster. It doesn't need to be configured, and it collected automatically by SpiderCoordinator</td>
<td>[]stirng</td>
<td>optional</td>
<td>[]string{}</td>
</tr>
<tr>
<td>hijackCIDR</td>
<td>The CIDR that need to be forwarded via the host network, For example, the address of nodelocaldns(169.254.20.10/32 by default)</td>
<td>[]stirng</td>
<td>optional</td>
<td>[]string{}</td>
</tr>
<tr>
<td>hostRuleTable</td>
<td>The routes on the host that communicates with the pod's underlay IPs will belong to this routing table number</td>
<td>int</td>
<td>optional</td>
<td>500</td>
</tr>
<tr>
<td>hostRPFilter</td>
<td>Set the rp_filter sysctl parameter on the host, which is recommended to be set to 0</td>
<td>int</td>
<td>optional</td>
<td>0</td>
</tr>
<tr>
<td>detectOptions</td>
<td>The advanced configuration of detectGateway and detectIPConflict, including retry numbers(default is 3), interval(default is 1s) and timeout(default is 1s)</td>
<td>obejct</td>
<td>optional</td>
<td>nil</td>
</tr>
<tr>
<td>logOptions</td>
<td>The configuration of logging, including logLevel(default is debug) and logFile(default is /var/log/spidernet/coordinator.log)</td>
<td>obejct</td>
<td>optional</td>
<td>nil</td>
</tr>
</tbody>
</table>
<h2 id="configure-examples">Configure Examples</h2>
<ul>
<li>Supports detecting if the IP of a pod is in conflict</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.cni.cncf.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NetworkAttachmentDefinition</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">coordinator-demo</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<span class="w">    </span><span class="no">{</span>
<span class="w">        </span><span class="no">&quot;cniVersion&quot;: &quot;0.3.1&quot;,</span>
<span class="w">        </span><span class="no">&quot;name&quot;: &quot;coordinator&quot;,</span>
<span class="w">        </span><span class="no">&quot;plugins&quot;: [</span>
<span class="w">            </span><span class="no">{</span>
<span class="w">                </span><span class="no">&quot;type&quot;: &quot;macvlan&quot;,</span>
<span class="w">                </span><span class="no">&quot;master&quot;: &quot;ens160&quot;,</span>
<span class="w">                </span><span class="no">&quot;mode&quot;: &quot;bridge&quot;,</span>
<span class="w">                </span><span class="no">&quot;ipam&quot;: {</span>
<span class="w">                    </span><span class="no">&quot;type&quot;: &quot;spiderpool&quot;</span>
<span class="w">                </span><span class="no">}</span>
<span class="w">            </span><span class="no">},{</span>
<span class="w">                </span><span class="no">&quot;type&quot;: &quot;coordinator&quot;,</span>
<span class="w">                </span><span class="no">&quot;mode&quot;: &quot;auto&quot;,</span>
<span class="w">                </span><span class="no">&quot;detectIPConflict&quot;: false</span>
<span class="w">            </span><span class="no">}</span>
<span class="w">        </span><span class="no">]</span>
<span class="w">    </span><span class="no">}</span>
</code></pre></div>
<ul>
<li>Supports detecting if the IP of a pod is in conflict</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.cni.cncf.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NetworkAttachmentDefinition</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">coordinator-demo</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<span class="w">    </span><span class="no">{</span>
<span class="w">        </span><span class="no">&quot;cniVersion&quot;: &quot;0.3.1&quot;,</span>
<span class="w">        </span><span class="no">&quot;name&quot;: &quot;coordinator&quot;,</span>
<span class="w">        </span><span class="no">&quot;plugins&quot;: [</span>
<span class="w">            </span><span class="no">{</span>
<span class="w">                </span><span class="no">&quot;type&quot;: &quot;macvlan&quot;,</span>
<span class="w">                </span><span class="no">&quot;master&quot;: &quot;ens160&quot;,</span>
<span class="w">                </span><span class="no">&quot;mode&quot;: &quot;bridge&quot;,</span>
<span class="w">                </span><span class="no">&quot;ipam&quot;: {</span>
<span class="w">                    </span><span class="no">&quot;type&quot;: &quot;spiderpool&quot;</span>
<span class="w">                </span><span class="no">}</span>
<span class="w">            </span><span class="no">},{</span>
<span class="w">                </span><span class="no">&quot;type&quot;: &quot;coordinator&quot;,</span>
<span class="w">                </span><span class="no">&quot;mode&quot;: &quot;auto&quot;,</span>
<span class="w">                </span><span class="no">&quot;detectIPConflict&quot;: true</span>
<span class="w">            </span><span class="no">}</span>
<span class="w">        </span><span class="no">]</span>
<span class="w">    </span><span class="no">}</span>
</code></pre></div>
<ul>
<li>Supports detecting if the gateway of a pod is reachable</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.cni.cncf.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NetworkAttachmentDefinition</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">coordinator-demo</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<span class="w">    </span><span class="no">{</span>
<span class="w">        </span><span class="no">&quot;cniVersion&quot;: &quot;0.3.1&quot;,</span>
<span class="w">        </span><span class="no">&quot;name&quot;: &quot;coordinator&quot;,</span>
<span class="w">        </span><span class="no">&quot;plugins&quot;: [</span>
<span class="w">            </span><span class="no">{</span>
<span class="w">                </span><span class="no">&quot;type&quot;: &quot;macvlan&quot;,</span>
<span class="w">                </span><span class="no">&quot;master&quot;: &quot;ens160&quot;,</span>
<span class="w">                </span><span class="no">&quot;mode&quot;: &quot;bridge&quot;,</span>
<span class="w">                </span><span class="no">&quot;ipam&quot;: {</span>
<span class="w">                    </span><span class="no">&quot;type&quot;: &quot;spiderpool&quot;</span>
<span class="w">                </span><span class="no">}</span>
<span class="w">            </span><span class="no">},{</span>
<span class="w">                </span><span class="no">&quot;type&quot;: &quot;coordinator&quot;,</span>
<span class="w">                </span><span class="no">&quot;detectGateway&quot;: true</span>
<span class="w">            </span><span class="no">}</span>
<span class="w">        </span><span class="no">]</span>
<span class="w">    </span><span class="no">}</span>
</code></pre></div>
<ul>
<li>Support for fixing MAC address prefixes for pods</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.cni.cncf.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NetworkAttachmentDefinition</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">coordinator-demo</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<span class="w">    </span><span class="no">{</span>
<span class="w">        </span><span class="no">&quot;cniVersion&quot;: &quot;0.3.1&quot;,</span>
<span class="w">        </span><span class="no">&quot;name&quot;: &quot;coordinator&quot;,</span>
<span class="w">        </span><span class="no">&quot;plugins&quot;: [</span>
<span class="w">            </span><span class="no">{</span>
<span class="w">                </span><span class="no">&quot;type&quot;: &quot;macvlan&quot;,</span>
<span class="w">                </span><span class="no">&quot;master&quot;: &quot;ens160&quot;,</span>
<span class="w">                </span><span class="no">&quot;mode&quot;: &quot;bridge&quot;,</span>
<span class="w">                </span><span class="no">&quot;ipam&quot;: {</span>
<span class="w">                    </span><span class="no">&quot;type&quot;: &quot;spiderpool&quot;</span>
<span class="w">                </span><span class="no">}</span>
<span class="w">            </span><span class="no">},{</span>
<span class="w">                </span><span class="no">&quot;type&quot;: &quot;coordinator&quot;,</span>
<span class="w">                </span><span class="no">&quot;podMACPrefix&quot;: &quot;0a:1b&quot;</span>
<span class="w">            </span><span class="no">}</span>
<span class="w">        </span><span class="no">]</span>
<span class="w">    </span><span class="no">}</span>
</code></pre></div>
<ul>
<li>Setting pod's default route NIC while pod in Multi-NIC mode</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.cni.cncf.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NetworkAttachmentDefinition</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">coordinator-demo</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<span class="w">    </span><span class="no">{</span>
<span class="w">        </span><span class="no">&quot;cniVersion&quot;: &quot;0.3.1&quot;,</span>
<span class="w">        </span><span class="no">&quot;name&quot;: &quot;coordinator&quot;,</span>
<span class="w">        </span><span class="no">&quot;plugins&quot;: [</span>
<span class="w">            </span><span class="no">{</span>
<span class="w">                </span><span class="no">&quot;type&quot;: &quot;macvlan&quot;,</span>
<span class="w">                </span><span class="no">&quot;master&quot;: &quot;ens160&quot;,</span>
<span class="w">                </span><span class="no">&quot;mode&quot;: &quot;bridge&quot;,</span>
<span class="w">                </span><span class="no">&quot;ipam&quot;: {</span>
<span class="w">                    </span><span class="no">&quot;type&quot;: &quot;spiderpool&quot;</span>
<span class="w">                </span><span class="no">}</span>
<span class="w">            </span><span class="no">},{</span>
<span class="w">                </span><span class="no">&quot;type&quot;: &quot;coordinator&quot;,</span>
<span class="w">                </span><span class="no">&quot;podDefaultRouteNic&quot;: &quot;eth0&quot;</span>
<span class="w">            </span><span class="no">}</span>
<span class="w">        </span><span class="no">]</span>
<span class="w">    </span><span class="no">}</span>
</code></pre></div>
<blockquote>
<p>You can also set it by <code>ipam.spidernet.io/default-route-nic: eth0</code> in the pod's annotations.</p>
</blockquote>
<ul>
<li>Configure the subnets that need to be forwarded via the host network</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.cni.cncf.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NetworkAttachmentDefinition</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">coordinator-demo</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<span class="w">    </span><span class="no">{</span>
<span class="w">        </span><span class="no">&quot;cniVersion&quot;: &quot;0.3.1&quot;,</span>
<span class="w">        </span><span class="no">&quot;name&quot;: &quot;coordinator&quot;,</span>
<span class="w">        </span><span class="no">&quot;plugins&quot;: [</span>
<span class="w">            </span><span class="no">{</span>
<span class="w">                </span><span class="no">&quot;type&quot;: &quot;macvlan&quot;,</span>
<span class="w">                </span><span class="no">&quot;master&quot;: &quot;ens160&quot;,</span>
<span class="w">                </span><span class="no">&quot;mode&quot;: &quot;bridge&quot;,</span>
<span class="w">                </span><span class="no">&quot;ipam&quot;: {</span>
<span class="w">                    </span><span class="no">&quot;type&quot;: &quot;spiderpool&quot;</span>
<span class="w">                </span><span class="no">}</span>
<span class="w">            </span><span class="no">},{</span>
<span class="w">                </span><span class="no">&quot;type&quot;: &quot;coordinator&quot;,</span>
<span class="w">                </span><span class="no">&quot;hijackCIDR&quot;: [&quot;169.254.20.10/32&quot;]</span>
<span class="w">            </span><span class="no">}</span>
<span class="w">        </span><span class="no">]</span>
<span class="w">    </span><span class="no">}</span>
</code></pre></div>
<blockquote>
<p>169.254.20.10/32 is default ip address of nodelocaldns.</p>
</blockquote>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../crd-spiderreservedip/" class="btn btn-neutral float-left" title="CRD SpiderReservedIP"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../plugin-ifacer/" class="btn btn-neutral float-right" title="Ifacer plugin">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../crd-spiderreservedip/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../plugin-ifacer/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
      <script src="../../js/version-select.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>

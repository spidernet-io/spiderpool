<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Contribution Guide - spiderpool</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../css/version-select.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Contribution Guide";
        var mkdocs_page_input_path = "develop/contributing.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> spiderpool
        </a>
        <div class="version">
          {'provider': 'mike'}
        </div><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Spiderpool</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Installation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/install/install/">Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Underlay installation</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../usage/install/underlay/get-started-calico/">Calico</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../usage/install/underlay/get-started-weave/">Weave</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../usage/install/underlay/get-started-kind/">Macvlan</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../usage/install/underlay/get-started-ovs/">Ovs</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../usage/install/underlay/get-started-sriov/">SRIOV</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Overlay installation</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../usage/install/overlay/get-started-calico/">Calico</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../usage/install/overlay/get-started-cilium/">Cilium</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Public cloud installation</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../usage/install/cloud/get-started-alibaba/">alibaba cloud</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../usage/install/cloud/get-started-vmware/">vmware vsphere</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../usage/install/cloud/get-started-openstack/">openstack</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/install/upgrade/">Upgrading</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/install/certificate/">Certificates</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Usage</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/spider-subnet/">SpiderSubnet</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/ippool-namespace/">Default IPPool at namespace</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/multi-interfaces-annotation/">Multiple interfaces</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/ippool-multi/">Backup IPPool</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/ippool-affinity-namespace/">Namespace affinity of IPPool</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/ippool-affinity-node/">Node affinity of IPPool</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/ippool-affinity-pod/">Pod affinity of IPPool</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/ipv6/">IPv6 support</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/statefulset/">StatefulSet</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/reserved-ip/">Reserved IP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/third-party-controller/">Third-party controllers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/gc/">Reclaim IP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/route/">Route support</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/coordinator/">Plugin coordinator</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/ifacer/">Plugin ifacer</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/network-topology/">node-based topology</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../usage/debug/">FAQ</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Concepts</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../concepts/arch/">Architecture</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../concepts/allocation/">IP Allocation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../concepts/metrics/">Metrics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../concepts/multusconfig/">Multus</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../concepts/gc/">Recycle IP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../concepts/solution/">Underlay and overlay solutions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../concepts/performance/">IPAM Performance</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../reference/annotation/">Annotations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../reference/configmap/">Configmap</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../reference/spiderpool-controller/">spiderpool-controller</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../reference/spiderpool-agent/">spiderpool-agent</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../reference/crd-spidersubnet/">CRD SpiderSubnet</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../reference/crd-spiderippool/">CRD SpiderIPPool</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../reference/crd-spidermultusconfig/">CRD Spidermultusconfig</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../reference/crd-spidercoordinator/">CRD Spidercoordinator</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../reference/crd-spiderendpoint/">CRD SpiderEndpoint</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../reference/crd-spiderreservedip/">CRD SpiderReservedIP</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../reference/plugin-ifacer/">Ifacer plugin</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../reference/plugin-ipam/">IPAM plugin</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Development</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Contribution Guide</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#unitest">unitest</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#setup-cluster-and-run-test">setup cluster and run test</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#submit-pull-request">Submit Pull Request</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#changelog">Changelog</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CODE-OF-CONDUCT/">Code of Conduct</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../release/">Release workflow</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../roadmap/">Roadmap</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../swagger_openapi/">Swagger OpenAPI</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">spiderpool</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
          <li>Development &raquo;</li>
      <li class="breadcrumb-item active">Contribution Guide</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/spidernet-io/spiderpool/edit/master/docs/develop/contributing.md">Edit on spidernet-io/spiderpool</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="contributing">contributing</h1>
<hr />
<h2 id="unitest">unitest</h2>
<p>run the following command to check unitest</p>
<p><code>make unitest-tests</code></p>
<h2 id="setup-cluster-and-run-test">setup cluster and run test</h2>
<ol>
<li>
<p>check required developing tools on you local host. If something missing, please run 'test/scripts/install-tools.sh' to install them</p>
<pre><code># make dev-doctor
go version go1.17 linux/amd64
check e2e tools 
pass   'docker' installed
pass   'kubectl' installed
pass   'kind' installed
pass   'p2ctl' installed
finish checking e2e tools
</code></pre>
</li>
<li>
<p>run the e2e</p>
<pre><code># make e2e
</code></pre>
</li>
</ol>
<p>if your run it for the first time, it will download some images, you could set the http proxy</p>
<pre><code>    # ADDR=10.6.0.1
    # export https_proxy=http://${ADDR}:7890 http_proxy=http://${ADDR}:7890
    # make e2e
</code></pre>
<p>run a specified case</p>
<pre><code>    # make e2e -e E2E_GINKGO_LABELS="lable1,label2"
</code></pre>
<ol>
<li>
<p>you could do it step by step with the follow</p>
<p>before start the test, you shoud know there are test scenes as following </p>
<table>
<thead>
<tr>
<th>kind</th>
<th>setup cluster</th>
<th>test</th>
</tr>
</thead>
<tbody>
<tr>
<td>test underlay CNI without subnet feature</td>
<td>make    e2e_init_underlay</td>
<td>make e2e_test_underlay</td>
</tr>
<tr>
<td>test underlay CNI with subnet feature</td>
<td>make    e2e_init_underlay_subnet</td>
<td>make e2e_test_underlay_subnet</td>
</tr>
<tr>
<td>test overlay CNI for calico</td>
<td>make    e2e_init_overlay_calico</td>
<td>make e2e_test_overlay_calico</td>
</tr>
<tr>
<td>test overlay CNI for cilium</td>
<td>make    e2e_init_overlay_cilium</td>
<td>make e2e_test_overlay_cilium</td>
</tr>
</tbody>
</table>
<p>if you are in China, it could add <code>-e E2E_CHINA_IMAGE_REGISTRY=true</code> to pull images from china image registry, add <code>-e HTTP_PROXY=http://${ADDR}</code> to get chart</p>
<p>build the image</p>
<pre><code># do some coding

$ git add .
$ git commit -s -m 'message'

# !!! images is built by commit sha, so make sure the commit is submit locally
$ make build_image
# or (if buildx fail to pull images)
$ make build_docker_image
</code></pre>
<p>setup the cluster</p>
<pre><code># setup the kind cluster of dual-stack
# !!! images is tested by commit sha, so make sure the commit is submit locally
$ make e2e_init_underlay
  .......
  -----------------------------------------------------------------------------------------------------
     succeeded to setup cluster spider
     you could use following command to access the cluster
        export KUBECONFIG=$(pwd)/test/.cluster/spider/.kube/config
        kubectl get nodes
  -----------------------------------------------------------------------------------------------------

# setup the kind cluster of ipv4-only
$ make e2e_init_underlay -e E2E_IP_FAMILY=ipv4

# setup the kind cluster of ipv6-only
$ make e2e_init_underlay -e E2E_IP_FAMILY=ipv6

# for china developer not able access ghcr.io
# it pulls images from another image registry and just use http proxy to pull chart 
$ make e2e_init_underlay  -e E2E_CHINA_IMAGE_REGISTRY=true -e HTTP_PROXY=http://${ADDR}

# setup cluster with subnet feature
$ make e2e_init_underlay_subnet -e E2E_CHINA_IMAGE_REGISTRY=true -e HTTP_PROXY=http://${ADDR}

# setup cluster with calico cni
$ make e2e_init_calico -e E2E_CHINA_IMAGE_REGISTRY=true -e HTTP_PROXY=http://${ADDR}

# setup cluster with cilium cni
$ make e2e_init_cilium  -e E2E_CHINA_IMAGE_REGISTRY=true -e HTTP_PROXY=http://${ADDR}
</code></pre>
<p>run the e2e test</p>
<pre><code># run all e2e test on dual-stack cluster
$ make e2e_test_underlay

# run all e2e test on ipv4-only cluster
$ make e2e_test_underlay -e E2E_IP_FAMILY=ipv4

# run all e2e test on ipv6-only cluster
$ make e2e_test_underlay -e E2E_IP_FAMILY=ipv6

# run smoke test
$ make e2e_test_underlay -e E2E_GINKGO_LABELS=smoke

# after finishing e2e case , you could test repeated for debugging flaky tests
# example: run a case repeatedly
$ make e2e_test_underlay -e E2E_GINKGO_LABELS=CaseLabel -e GINKGO_OPTION="--repeat=10 "

# example: run a case until fails
$ make e2e_test_underlay -e GINKGO_OPTION=" --label-filter=CaseLabel --until-it-fails "

# Run all e2e tests for enableSpiderSubnet=false cluster
$ make e2e_test_underlay_subnet

# Run all e2e tests for enableSpiderSubnet=false cluster
$ make e2e_test_calico

# Run all e2e tests for enableSpiderSubnet=false cluster
$ make e2e_test_cilium

$ ls e2ereport.json

$ make clean_e2e
</code></pre>
</li>
<li>
<p>you could test specified images with the follow</p>
<pre><code># load images to docker
$ docker pull ${AGENT_IMAGE_NAME}:${IMAGE_TAG}
$ docker pull ${CONTROLLER_IMAGE_NAME}:${IMAGE_TAG}
$ docker pull ${CONTROLLER_IMAGE_NAME}:${IMAGE_TAG}
$ docker pull ${MULTUS_IMAGE_NAME}:${IMAGE_TAG}

# setup the cluster with the specified image
$ make e2e_init_underlay -e E2E_SPIDERPOOL_TAG=${IMAGE_TAG} \
        -e SPIDERPOOL_AGENT_IMAGE_NAME=${AGENT_IMAGE_NAME}   \
        -e SPIDERPOOL_CONTROLLER_IMAGE_NAME=${CONTROLLER_IMAGE_NAME} \
        -e E2E_MULTUS_IMAGE_NAME=${MULTUS_IMAGE_NAME}

# run all e2e test
$ make e2e_test
</code></pre>
</li>
<li>
<p>finally, you could visit "<a href="http://HostIp:4040">http://HostIp:4040</a>" the in the browser of your desktop, and get flamegraph</p>
</li>
<li>
<p>clean <code>make clean_e2e</code></p>
</li>
</ol>
<hr />
<h2 id="submit-pull-request">Submit Pull Request</h2>
<p>A pull request will be checked by following workflow, which is required for merging.</p>
<h3 id="action-your-pr-should-be-signed-off">Action: your PR should be signed off</h3>
<p>When you commit your modification, add <code>-s</code> in your commit command <code>git commit -s</code></p>
<h3 id="action-check-yaml-files">Action: check yaml files</h3>
<p>If this check fails, see the <a href="https://yamllint.readthedocs.io/en/stable/rules.html">yaml rule</a>.</p>
<p>Once the issue is fixed, it could be verified on your local host by command <code>make lint-yaml</code>.</p>
<p>Note: To ignore a yaml rule, you can add it into <code>.github/yamllint-conf.yml</code>.</p>
<h3 id="action-check-golang-source-code">Action: check golang source code</h3>
<p>It checks the following items against any updated golang file.</p>
<ul>
<li>
<p>Mod dependency updated, golangci-lint, gofmt updated, go vet, use internal lock pkg</p>
</li>
<li>
<p>Comment <code>// TODO</code> should follow the format: <code>// TODO (AuthorName) ...</code>, which easy to trace the owner of the remaining job</p>
</li>
<li>
<p>Unitest and upload coverage to codecov</p>
</li>
<li>
<p>Each golang test file should mark ginkgo label</p>
</li>
</ul>
<h3 id="action-check-licenses">Action: check licenses</h3>
<p>Any golang or shell file should be licensed correctly.</p>
<h3 id="action-check-markdown-file">Action: check markdown file</h3>
<ul>
<li>Check markdown format, if fails, See the <a href="https://github.com/DavidAnson/markdownlint/blob/main/doc/Rules.md">Markdown Rule</a></li>
</ul>
<p>You can test it on your local machine with the command <code>make lint-markdown-format</code>.</p>
<p>You can fix it on your local machine with the command <code>make fix-markdown-format</code>.</p>
<p>If you believe it can be ignored, you can add it to <code>.github/markdownlint.yaml</code>.</p>
<ul>
<li>Check markdown spell error.</li>
</ul>
<p>You can test it with the command <code>make lint-markdown-spell-colour</code>.</p>
<p>If you believe it can be ignored, you can add it to <code>.github/.spelling</code>.</p>
<h3 id="action-lint-yaml-file">Action: lint yaml file</h3>
<p>If it fails, see <a href="https://yamllint.readthedocs.io/en/stable/rules.html">https://yamllint.readthedocs.io/en/stable/rules.html</a> for reasons.</p>
<p>You can test it on your local machine with the command <code>make lint-yaml</code>.</p>
<h3 id="action-lint-chart">Action: lint chart</h3>
<h3 id="action-lint-openapiyaml">Action: lint openapi.yaml</h3>
<h3 id="action-check-code-spell">Action: check code spell</h3>
<p>Any code spell error of golang files will be checked.</p>
<p>You can check it on your local machine with the command <code>make lint-code-spell</code>.</p>
<p>It could be automatically fixed on your local machine with the command <code>make fix-code-spell</code>.</p>
<p>If you believe it can be ignored, edit <code>.github/codespell-ignorewords</code> and make sure all letters are lower-case.</p>
<h2 id="changelog">Changelog</h2>
<p>How to automatically generate changelogs:</p>
<ol>
<li>
<p>All PRs should be labeled with "pr/release/***" and can be merged.</p>
</li>
<li>
<p>When you add the label, the changelog will be created automatically.</p>
</li>
</ol>
<p>The changelog contents include:</p>
<ul>
<li>
<p>New Features: it includes all PRs labeled with "pr/release/feature-new"</p>
</li>
<li>
<p>Changed Features: it includes all PRs labeled with "pr/release/feature-changed"</p>
</li>
<li>
<p>Fixes: it includes all PRs labeled with "pr/release/bug"</p>
</li>
<li>
<p>All historical commits within this version</p>
</li>
<li>
<p>The changelog will be attached to Github RELEASE and submitted to /changelogs of branch 'github_pages'.</p>
</li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../reference/plugin-ipam/" class="btn btn-neutral float-left" title="IPAM plugin"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../CODE-OF-CONDUCT/" class="btn btn-neutral float-right" title="Code of Conduct">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../../reference/plugin-ipam/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../CODE-OF-CONDUCT/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
      <script src="../../js/version-select.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>

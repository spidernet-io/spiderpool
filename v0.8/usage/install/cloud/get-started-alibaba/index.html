
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-8.5.10">
    
    
      
        <title>Alibaba Cloud - spiderpool</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#running-on-alibaba-cloud" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
  You're not viewing the latest version.
  <a href="../../../../..">
    <strong>Click here to go to latest.</strong>
  </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="spiderpool" class="md-header__button md-logo" aria-label="spiderpool" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            spiderpool
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Alibaba Cloud
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/spidernet-io/spiderpool" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    spidernet-io/spiderpool
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="spiderpool" class="md-nav__button md-logo" aria-label="spiderpool" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    spiderpool
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/spidernet-io/spiderpool" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    spidernet-io/spiderpool
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../get-started-kind/" class="md-nav__link">
        Quick Start
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../readme/" class="md-nav__link">
        Index
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Installation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Installation" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Installation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1" type="checkbox" id="__nav_4_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_1">
          Underlay Installation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Underlay Installation" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          Underlay Installation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../underlay/get-started-calico/" class="md-nav__link">
        Calico
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../underlay/get-started-weave/" class="md-nav__link">
        Weave
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../underlay/get-started-macvlan/" class="md-nav__link">
        Macvlan
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../underlay/get-started-ovs/" class="md-nav__link">
        Ovs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../underlay/get-started-sriov/" class="md-nav__link">
        SR-IOV
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_2">
          Overlay Installation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Overlay Installation" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Overlay Installation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../overlay/get-started-calico/" class="md-nav__link">
        Calico
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../overlay/get-started-cilium/" class="md-nav__link">
        Cilium
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3" type="checkbox" id="__nav_4_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4_3">
          Public Cloud Installation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Public Cloud Installation" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          Public Cloud Installation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Alibaba Cloud
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Alibaba Cloud
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#features" class="md-nav__link">
    Features
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#steps" class="md-nav__link">
    Steps
  </a>
  
    <nav class="md-nav" aria-label="Steps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alibaba-cloud-environment" class="md-nav__link">
    Alibaba Cloud Environment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-spiderpool" class="md-nav__link">
    Install Spiderpool
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-cni" class="md-nav__link">
    Install CNI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-ip-pools" class="md-nav__link">
    Create IP Pools
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-applications" class="md-nav__link">
    Create Applications
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-east-west-connectivity" class="md-nav__link">
    Test East-West Connectivity
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-north-south-connectivity" class="md-nav__link">
    Test North-South Connectivity
  </a>
  
    <nav class="md-nav" aria-label="Test North-South Connectivity">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-egress-traffic-from-pods-to-external-destinations" class="md-nav__link">
    Test egress traffic from Pods to external destinations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load-balancer-traffic-ingress-access" class="md-nav__link">
    Load Balancer Traffic Ingress Access
  </a>
  
    <nav class="md-nav" aria-label="Load Balancer Traffic Ingress Access">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-cloud-controller-manager" class="md-nav__link">
    Deploy Cloud Controller Manager
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-load-balancer-ingress-for-applications" class="md-nav__link">
    Create Load Balancer Ingress for Applications
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verify-load-balancer-traffic-ingress-access" class="md-nav__link">
    Verify Load Balancer Traffic Ingress Access
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../get-started-aws/" class="md-nav__link">
        AWS Cloud
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../get-started-vmware/" class="md-nav__link">
        VWware vSphere
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../get-started-openstack/" class="md-nav__link">
        OpenStack
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/" class="md-nav__link">
        Upgrading
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../system-requirements/" class="md-nav__link">
        System requirements
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Concepts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Concepts" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Concepts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/arch/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/ipam-des/" class="md-nav__link">
        IPAM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/ipam-performance/" class="md-nav__link">
        IPAM Performance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/coordinator/" class="md-nav__link">
        Plugin coordinator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/io-performance/" class="md-nav__link">
        I/O Performance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../concepts/blog/" class="md-nav__link">
        Blogs
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Usage
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Usage" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Usage
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../spider-multus-config/" class="md-nav__link">
        SpiderMultusConfig
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../spider-ippool/" class="md-nav__link">
        IPAM of SpiderIPPool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../spider-affinity/" class="md-nav__link">
        IPAM of IPPool Affinity
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../spider-subnet/" class="md-nav__link">
        IPAM of SpiderSubnet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../operator/" class="md-nav__link">
        IPAM for operator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../statefulset/" class="md-nav__link">
        IPAM for StatefulSet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../reserved-ip/" class="md-nav__link">
        IPAM of Reserved IP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../multi-interfaces-annotation/" class="md-nav__link">
        MultipleInterfaces
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../egress/" class="md-nav__link">
        Egress Policy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../cilium-chaining/" class="md-nav__link">
        Network Policy Support
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../route/" class="md-nav__link">
        Route Support
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../network-topology/" class="md-nav__link">
        Node-based Topology
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../rdma/" class="md-nav__link">
        RDMA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../submariner/" class="md-nav__link">
        Multi-Cluster Networking
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../underlay_cni_service/" class="md-nav__link">
        Access Service for Underlay CNI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../multi_cni_coexist/" class="md-nav__link">
        Coexistence of multi CNIs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../kubevirt/" class="md-nav__link">
        Kubevirt
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../istio/" class="md-nav__link">
        Istio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../faq/" class="md-nav__link">
        FAQ
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/annotation/" class="md-nav__link">
        Annotations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/configmap/" class="md-nav__link">
        Configmap
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/metrics/" class="md-nav__link">
        Metrics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/spiderpool-controller/" class="md-nav__link">
        spiderpool-controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/spiderpool-agent/" class="md-nav__link">
        spiderpool-agent
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/crd-spidersubnet/" class="md-nav__link">
        CRD SpiderSubnet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/crd-spiderippool/" class="md-nav__link">
        CRD SpiderIPPool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/crd-spidermultusconfig/" class="md-nav__link">
        CRD Spidermultusconfig
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/crd-spidercoordinator/" class="md-nav__link">
        CRD Spidercoordinator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/crd-spiderendpoint/" class="md-nav__link">
        CRD SpiderEndpoint
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/crd-spiderreservedip/" class="md-nav__link">
        CRD SpiderReservedIP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/plugin-ifacer/" class="md-nav__link">
        Ifacer plugin
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../reference/plugin-ipam/" class="md-nav__link">
        IPAM plugin
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Development
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Development" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../develop/contributing/" class="md-nav__link">
        Contribution Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../develop/CODE-OF-CONDUCT/" class="md-nav__link">
        Code of Conduct
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../develop/release/" class="md-nav__link">
        Release workflow
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../develop/roadmap/" class="md-nav__link">
        Roadmap
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../develop/swagger_openapi/" class="md-nav__link">
        Swagger OpenAPI
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#features" class="md-nav__link">
    Features
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#steps" class="md-nav__link">
    Steps
  </a>
  
    <nav class="md-nav" aria-label="Steps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alibaba-cloud-environment" class="md-nav__link">
    Alibaba Cloud Environment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-spiderpool" class="md-nav__link">
    Install Spiderpool
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-cni" class="md-nav__link">
    Install CNI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-ip-pools" class="md-nav__link">
    Create IP Pools
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-applications" class="md-nav__link">
    Create Applications
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-east-west-connectivity" class="md-nav__link">
    Test East-West Connectivity
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-north-south-connectivity" class="md-nav__link">
    Test North-South Connectivity
  </a>
  
    <nav class="md-nav" aria-label="Test North-South Connectivity">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-egress-traffic-from-pods-to-external-destinations" class="md-nav__link">
    Test egress traffic from Pods to external destinations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#load-balancer-traffic-ingress-access" class="md-nav__link">
    Load Balancer Traffic Ingress Access
  </a>
  
    <nav class="md-nav" aria-label="Load Balancer Traffic Ingress Access">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-cloud-controller-manager" class="md-nav__link">
    Deploy Cloud Controller Manager
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-load-balancer-ingress-for-applications" class="md-nav__link">
    Create Load Balancer Ingress for Applications
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verify-load-balancer-traffic-ingress-access" class="md-nav__link">
    Verify Load Balancer Traffic Ingress Access
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
  



  <a href="https://github.com/spidernet-io/spiderpool/edit/master/docs/usage/install/cloud/get-started-alibaba.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="running-on-alibaba-cloud">Running On Alibaba Cloud</h1>
<p><strong>English</strong> | <a href="../get-started-alibaba-zh_CN/"><strong>简体中文</strong></a></p>
<h2 id="introduction">Introduction</h2>
<p>With a multitude of public cloud providers available, such as Alibaba Cloud, Huawei Cloud, Tencent Cloud, AWS, and more, it can be challenging to use mainstream open-source CNI plugins to operate on these platforms using Underlay networks. Instead, one has to rely on proprietary CNI plugins provided by each cloud vendor, leading to a lack of standardized Underlay solutions for public clouds. This page introduces <a href="../../../../">Spiderpool</a>, an Underlay networking solution designed to work seamlessly in any public cloud environment. A unified CNI solution offers easier management across multiple clouds, particularly in hybrid cloud scenarios.</p>
<h2 id="features">Features</h2>
<p>Spiderpool's node topology function can bind IP pools to the available IPs of each network card on each node, and also achieve the validity of MAC addresses.</p>
<p>Spiderpool can run on the Alibaba Cloud environment based on IPVlan Underlay CNI, and ensures that the east-west and north-south traffic of the cluster are normal. Its implementation principle is as follows:</p>
<ol>
<li>
<p>When using Underlay networks in a public cloud environment, each network interface of a cloud server can only be assigned a limited number of IP addresses. To enable communication when an application runs on a specific cloud server, it needs to obtain the valid IP addresses allocated to different network interfaces within the VPC network. To address this IP allocation requirement, Spiderpool introduces a CRD named <code>SpiderIPPool</code>. By configuring the nodeName and multusName fields in <code>SpiderIPPool</code>, it enables node topology functionality. Spiderpool leverages the affinity between the IP pool and nodes, as well as the affinity between the IP pool and IPvlan Multus, facilitating the utilization and management of available IP addresses on the nodes. This ensures that applications are assigned valid IP addresses, enabling seamless communication within the VPC network, including communication between Pods and also between Pods and cloud servers.</p>
</li>
<li>
<p>In a public cloud VPC network, network security controls and packet forwarding principles dictate that when network data packets contain MAC and IP addresses unknown to the VPC network, correct forwarding becomes unattainable. This issue arises in scenarios where Macvlan or OVS based Underlay CNI plugins generate new MAC addresses for Pod NICs, resulting in communication failures among Pods. To address this challenge, Spiderpool offers a solution in conjunction with <a href="https://www.cni.dev/plugins/current/main/ipvlan/">IPVlan CNI</a>. The IPVlan CNI operates at the L3 of the network, eliminating the reliance on L2 broadcasts and avoiding the generation of new MAC addresses. Instead, it maintains consistency with the parent interface. By incorporating IPVlan, the legitimacy of MAC addresses in a public cloud environment can be effectively resolved.</p>
</li>
</ol>
<h2 id="prerequisites">Prerequisites</h2>
<ol>
<li>
<p>The system kernel version must be greater than 4.2 when using IPVlan as the cluster's CNI.</p>
</li>
<li>
<p><a href="https://helm.sh/docs/intro/install/">Helm</a> is installed.</p>
</li>
</ol>
<h2 id="steps">Steps</h2>
<h3 id="alibaba-cloud-environment">Alibaba Cloud Environment</h3>
<ul>
<li>
<p>Prepare an Alibaba Cloud environment with virtual machines that have 2 network interfaces. Assign a set of auxiliary private IP addresses to each network interface, as shown in the picture:</p>
<p><img alt="alicloud-web-network" src="../../../../images/alicloud-network-web.png" /></p>
<blockquote>
<ul>
<li>An instance (virtual machine) is the smallest unit that can provide computing services for your business. Different instance specifications vary in the number of network cards that can be created and the number of auxiliary IPs that can be assigned to each network card. For more information on specific business and usage scenarios, refer to Alibaba Cloud <a href="https://help.aliyun.com/zh/ecs/user-guide/overview-of-instance-families#concept-sx4-lxv-tdb">Instance Specification Family</a> to select the corresponding specification to create an instance.</li>
<li>If you have IPv6 requirements, you can refer to Alibaba Cloud <a href="https://help.aliyun.com/zh/ecs/user-guide/configure-ipv6-addresses/?spm=a2c4g.11186623.0.0.21ee48beYHt7ZW">Configuring IPv6 Addresses</a>.</li>
</ul>
</blockquote>
</li>
<li>
<p>Utilize the configured VMs to build a Kubernetes cluster. The available IP addresses for the nodes and the network topology of the cluster are depicted below:</p>
<p><img alt="Network topology" src="../../../../images/alicloud-k8s-network.png" /></p>
</li>
</ul>
<h3 id="install-spiderpool">Install Spiderpool</h3>
<p>Install Spiderpool via helm:</p>
<div class="highlight"><pre><span></span><code>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>spiderpool<span class="w"> </span>https://spidernet-io.github.io/spiderpool

helm<span class="w"> </span>repo<span class="w"> </span>update<span class="w"> </span>spiderpool

helm<span class="w"> </span>install<span class="w"> </span>spiderpool<span class="w"> </span>spiderpool/spiderpool<span class="w"> </span>--namespace<span class="w"> </span>kube-system<span class="w"> </span>--set<span class="w"> </span>ipam.enableStatefulSet<span class="o">=</span><span class="nb">false</span><span class="w"> </span>--set<span class="w"> </span>multus.multusCNI.defaultCniCRName<span class="o">=</span><span class="s2">&quot;ipvlan-eth0&quot;</span>
</code></pre></div>
<blockquote>
<p>If IPVlan is not installed in your cluster, you can specify the Helm parameter <code>--set plugins.installCNI=true</code> to install IPVlan in your cluster.</p>
<p>If you are using a cloud server from a Chinese mainland cloud provider, you can enhance image pulling speed by specifying the parameter <code>--set global.imageRegistryOverride=ghcr.m.daocloud.io</code>.</p>
<p>Spiderpool allows for fixed IP addresses for application replicas with a controller type of <code>StatefulSet</code>. However, in the underlay network scenario of public clouds, cloud instances are limited to using specific IP addresses. When StatefulSet replicas migrate to different nodes, the original fixed IP becomes invalid and unavailable on the new node, causing network unavailability for the new Pods. To address this issue, set <code>ipam.enableStatefulSet</code> to <code>false</code> to disable this feature.</p>
<p>Specify the name of the NetworkAttachmentDefinition instance for the default CNI used by Multus via <code>multus.multusCNI.defaultCniCRName</code>. If the <code>multus.multusCNI.defaultCniCRName</code> option is provided, an empty NetworkAttachmentDefinition instance will be automatically generated upon installation. Otherwise, Multus will attempt to create a NetworkAttachmentDefinition instance based on the first CNI configuration found in the /etc/cni/net.d directory. If no suitable configuration is found, a NetworkAttachmentDefinition instance named <code>default</code> will be created to complete the installation of Multus.</p>
</blockquote>
<h3 id="install-cni">Install CNI</h3>
<p>To simplify the creation of JSON-formatted Multus CNI configurations, Spiderpool offers the SpiderMultusConfig CR to automatically manage Multus NetworkAttachmentDefinition CRs. Here is an example of creating an IPvlan SpiderMultusConfig configuration:</p>
<div class="highlight"><pre><span></span><code><span class="nv">IPVLAN_MASTER_INTERFACE0</span><span class="o">=</span><span class="s2">&quot;eth0&quot;</span>
<span class="nv">IPVLAN_MULTUS_NAME0</span><span class="o">=</span><span class="s2">&quot;ipvlan-</span><span class="nv">$IPVLAN_MASTER_INTERFACE0</span><span class="s2">&quot;</span>
<span class="nv">IPVLAN_MASTER_INTERFACE1</span><span class="o">=</span><span class="s2">&quot;eth1&quot;</span>
<span class="nv">IPVLAN_MULTUS_NAME1</span><span class="o">=</span><span class="s2">&quot;ipvlan-</span><span class="nv">$IPVLAN_MASTER_INTERFACE1</span><span class="s2">&quot;</span>

cat<span class="w"> </span><span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<span class="s">apiVersion: spiderpool.spidernet.io/v2beta1</span>
<span class="s">kind: SpiderMultusConfig</span>
<span class="s">metadata:</span>
<span class="s">  name: ${IPVLAN_MULTUS_NAME0}</span>
<span class="s">  namespace: kube-system</span>
<span class="s">spec:</span>
<span class="s">  cniType: ipvlan</span>
<span class="s">  enableCoordinator: true</span>
<span class="s">  ipvlan:</span>
<span class="s">    master:</span>
<span class="s">    - ${IPVLAN_MASTER_INTERFACE0}</span>
<span class="s">---</span>
<span class="s">apiVersion: spiderpool.spidernet.io/v2beta1</span>
<span class="s">kind: SpiderMultusConfig</span>
<span class="s">metadata:</span>
<span class="s">  name: ${IPVLAN_MULTUS_NAME1}</span>
<span class="s">  namespace: kube-system</span>
<span class="s">spec:</span>
<span class="s">  cniType: ipvlan</span>
<span class="s">  enableCoordinator: true</span>
<span class="s">  ipvlan:</span>
<span class="s">    master:</span>
<span class="s">    - ${IPVLAN_MASTER_INTERFACE1}</span>
<span class="s">EOF</span>
</code></pre></div>
<p>This case uses the given configuration to create two IPvlan SpiderMultusConfig instances. These instances will automatically generate corresponding Multus NetworkAttachmentDefinition CRs for the host's <code>eth0</code> and <code>eth1</code> network interfaces.</p>
<div class="highlight"><pre><span></span><code>~#<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>spidermultusconfigs.spiderpool.spidernet.io<span class="w"> </span>-n<span class="w"> </span>kube-system
NAME<span class="w">          </span>AGE
ipvlan-eth0<span class="w">   </span>10m
ipvlan-eth1<span class="w">   </span>10m

~#<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>network-attachment-definitions.k8s.cni.cncf.io<span class="w"> </span>-n<span class="w"> </span>kube-system
NAME<span class="w">          </span>AGE
ipvlan-eth0<span class="w">   </span>10m
ipvlan-eth1<span class="w">   </span>10m
</code></pre></div>
<h3 id="create-ip-pools">Create IP Pools</h3>
<p>The Spiderpool's CRD, <code>SpiderIPPool</code>, introduces the following fields: <code>nodeName</code>, <code>multusName</code>, and <code>ips</code>:</p>
<ul>
<li>
<p><code>nodeName</code>: when <code>nodeName</code> is not empty, Pods are scheduled on a specific node and attempt to acquire an IP address from the corresponding SpiderIPPool. If the Pod's node matches the specified <code>nodeName</code>, it successfully obtains an IP. Otherwise, it cannot obtain an IP from that SpiderIPPool. When <code>nodeName</code> is empty, Spiderpool does not impose any allocation restrictions on the Pod.</p>
</li>
<li>
<p><code>multusName</code>：Spiderpool integrates with Multus CNI to cope with cases involving multiple network interface cards. When <code>multusName</code> is not empty, SpiderIPPool utilizes the corresponding Multus CR instance to configure the network for the Pod. If the Multus CR specified by <code>multusName</code> does not exist, Spiderpool cannot assign a Multus CR to the Pod. When <code>multusName</code> is empty, Spiderpool does not impose any restrictions on the Multus CR used by the Pod.</p>
</li>
<li>
<p><code>spec.ips</code>：this field must not be empty. Due to Alibaba Cloud's limitations on available IP addresses for nodes, the specified range of values must fall within the auxiliary private IP range of the host associated with the specified <code>nodeName</code>. You can obtain this information from the Elastic Network Interface page in the Alibaba Cloud console.</p>
</li>
</ul>
<p>Based on the provided information, use the following YAML configuration to create a SpiderIPPool for each network interface (eth0 and eth1) on every node. These SpiderIPPools will assign IP addresses to Pods running on different nodes.</p>
<div class="highlight"><pre><span></span><code>~#<span class="w"> </span>cat<span class="w"> </span><span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<span class="s">apiVersion: spiderpool.spidernet.io/v2beta1</span>
<span class="s">kind: SpiderIPPool</span>
<span class="s">metadata:</span>
<span class="s">  name: master-172</span>
<span class="s">spec:</span>
<span class="s">  default: true</span>
<span class="s">  ips:</span>
<span class="s">  - 172.31.199.185-172.31.199.189</span>
<span class="s">  subnet: 172.31.192.0/20</span>
<span class="s">  gateway: 172.31.207.253</span>
<span class="s">  nodeName:</span>
<span class="s">  - master</span>
<span class="s">  multusName:</span>
<span class="s">  - kube-system/ipvlan-eth0</span>
<span class="s">---</span>
<span class="s">apiVersion: spiderpool.spidernet.io/v2beta1</span>
<span class="s">kind: SpiderIPPool</span>
<span class="s">metadata:</span>
<span class="s">  name: master-192</span>
<span class="s">spec:</span>
<span class="s">  default: true</span>
<span class="s">  ips:</span>
<span class="s">  - 192.168.0.156-192.168.0.160</span>
<span class="s">  subnet: 192.168.0.0/24</span>
<span class="s">  gateway: 192.168.0.253</span>
<span class="s">  nodeName:</span>
<span class="s">  - master</span>
<span class="s">  multusName:</span>
<span class="s">  - kube-system/ipvlan-eth1</span>
<span class="s">---</span>
<span class="s">apiVersion: spiderpool.spidernet.io/v2beta1</span>
<span class="s">kind: SpiderIPPool</span>
<span class="s">metadata:</span>
<span class="s">  name: worker-172</span>
<span class="s">spec:</span>
<span class="s">  default: true</span>
<span class="s">  ips:</span>
<span class="s">  - 172.31.199.190-172.31.199.194</span>
<span class="s">  subnet: 172.31.192.0/20</span>
<span class="s">  gateway: 172.31.207.253</span>
<span class="s">  nodeName:</span>
<span class="s">  - worker</span>
<span class="s">  multusName:</span>
<span class="s">  - kube-system/ipvlan-eth0</span>
<span class="s">---</span>
<span class="s">apiVersion: spiderpool.spidernet.io/v2beta1</span>
<span class="s">kind: SpiderIPPool</span>
<span class="s">metadata:</span>
<span class="s">  name: worker-192</span>
<span class="s">spec:</span>
<span class="s">  default: true</span>
<span class="s">  ips:</span>
<span class="s">  - 192.168.0.161-192.168.0.165</span>
<span class="s">  subnet: 192.168.0.0/24</span>
<span class="s">  gateway: 192.168.0.253</span>
<span class="s">  nodeName:</span>
<span class="s">  - worker</span>
<span class="s">  multusName:</span>
<span class="s">  - kube-system/ipvlan-eth1</span>
<span class="s">EOF</span>
</code></pre></div>
<h3 id="create-applications">Create Applications</h3>
<p>In the following example YAML, there are 2 sets of DaemonSet applications and 1 service with a type of ClusterIP:</p>
<ul>
<li><code>v1.multus-cni.io/default-network</code>: specify the subnet that each application will use. In the example, the applications are assigned different subnets.</li>
</ul>
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span><span class="s">&lt;&lt;EOF | kubectl create -f -</span>
<span class="s">apiVersion: apps/v1</span>
<span class="s">kind: DaemonSet</span>
<span class="s">metadata:</span>
<span class="s">  labels:</span>
<span class="s">    app: test-app-1</span>
<span class="s">  name: test-app-1</span>
<span class="s">  namespace: default</span>
<span class="s">spec:</span>
<span class="s">  selector:</span>
<span class="s">    matchLabels:</span>
<span class="s">      app: test-app-1</span>
<span class="s">  template:</span>
<span class="s">    metadata:</span>
<span class="s">      labels:</span>
<span class="s">        app: test-app-1</span>
<span class="s">      annotations:</span>
<span class="s">        v1.multus-cni.io/default-network: kube-system/ipvlan-eth0</span>
<span class="s">    spec:</span>
<span class="s">      containers:</span>
<span class="s">      - image: busybox</span>
<span class="s">        command: [&quot;sleep&quot;, &quot;3600&quot;]</span>
<span class="s">        imagePullPolicy: IfNotPresent</span>
<span class="s">        name: test-app-1</span>
<span class="s">        ports:</span>
<span class="s">        - name: http</span>
<span class="s">          containerPort: 80</span>
<span class="s">          protocol: TCP</span>
<span class="s">---</span>
<span class="s">apiVersion: apps/v1</span>
<span class="s">kind: DaemonSet</span>
<span class="s">metadata:</span>
<span class="s">  labels:</span>
<span class="s">    app: test-app-2</span>
<span class="s">  name: test-app-2</span>
<span class="s">  namespace: default</span>
<span class="s">spec:</span>
<span class="s">  selector:</span>
<span class="s">    matchLabels:</span>
<span class="s">      app: test-app-2</span>
<span class="s">  template:</span>
<span class="s">    metadata:</span>
<span class="s">      labels:</span>
<span class="s">        app: test-app-2</span>
<span class="s">      annotations:</span>
<span class="s">        v1.multus-cni.io/default-network: kube-system/ipvlan-eth1</span>
<span class="s">    spec:</span>
<span class="s">      containers:</span>
<span class="s">      - image: nginx</span>
<span class="s">        imagePullPolicy: IfNotPresent</span>
<span class="s">        name: test-app-2</span>
<span class="s">        ports:</span>
<span class="s">        - name: http</span>
<span class="s">          containerPort: 80</span>
<span class="s">          protocol: TCP</span>
<span class="s">---</span>
<span class="s">apiVersion: v1</span>
<span class="s">kind: Service</span>
<span class="s">metadata:</span>
<span class="s">  name: test-svc</span>
<span class="s">  labels:</span>
<span class="s">    app: test-app-2</span>
<span class="s">spec:</span>
<span class="s">  type: ClusterIP</span>
<span class="s">  ports:</span>
<span class="s">    - port: 80</span>
<span class="s">      protocol: TCP</span>
<span class="s">      targetPort: 80</span>
<span class="s">  selector:</span>
<span class="s">    app: test-app-2</span>
<span class="s">EOF</span>
</code></pre></div>
<p>Check the status of the running Pods:</p>
<div class="highlight"><pre><span></span><code>~#<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>po<span class="w"> </span>-owide
NAME<span class="w">                </span>READY<span class="w">   </span>STATUS<span class="w">    </span>RESTARTS<span class="w">   </span>AGE<span class="w">   </span>IP<span class="w">               </span>NODE<span class="w">      </span>NOMINATED<span class="w"> </span>NODE<span class="w">   </span>READINESS<span class="w"> </span>GATES
test-app-1-ddlx7<span class="w">    </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>16s<span class="w">   </span><span class="m">172</span>.31.199.187<span class="w">   </span>master<span class="w">    </span>&lt;none&gt;<span class="w">           </span>&lt;none&gt;
test-app-1-jpfkj<span class="w">    </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>16s<span class="w">   </span><span class="m">172</span>.31.199.193<span class="w">   </span>worker<span class="w">    </span>&lt;none&gt;<span class="w">           </span>&lt;none&gt;
test-app-2-qbhwx<span class="w">    </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>12s<span class="w">   </span><span class="m">192</span>.168.0.160<span class="w">    </span>master<span class="w">    </span>&lt;none&gt;<span class="w">           </span>&lt;none&gt;
test-app-2-r6gwx<span class="w">    </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>12s<span class="w">   </span><span class="m">192</span>.168.0.161<span class="w">    </span>worker<span class="w">    </span>&lt;none&gt;<span class="w">           </span>&lt;none&gt;
</code></pre></div>
<p>Spiderpool automatically assigns IP addresses to the applications, ensuring that the assigned IPs are within the expected IP pool.</p>
<div class="highlight"><pre><span></span><code>~#<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>spiderippool
NAME<span class="w">         </span>VERSION<span class="w">   </span>SUBNET<span class="w">            </span>ALLOCATED-IP-COUNT<span class="w">   </span>TOTAL-IP-COUNT<span class="w">   </span>DEFAULT
master-172<span class="w">   </span><span class="m">4</span><span class="w">         </span><span class="m">172</span>.31.192.0/20<span class="w">   </span><span class="m">1</span><span class="w">                    </span><span class="m">5</span><span class="w">                </span><span class="nb">true</span>
master-192<span class="w">   </span><span class="m">4</span><span class="w">         </span><span class="m">192</span>.168.0.0/24<span class="w">    </span><span class="m">1</span><span class="w">                    </span><span class="m">5</span><span class="w">                </span><span class="nb">true</span>
worker-172<span class="w">   </span><span class="m">4</span><span class="w">         </span><span class="m">172</span>.31.192.0/20<span class="w">   </span><span class="m">1</span><span class="w">                    </span><span class="m">5</span><span class="w">                </span><span class="nb">true</span>
worker-192<span class="w">   </span><span class="m">4</span><span class="w">         </span><span class="m">192</span>.168.0.0/24<span class="w">    </span><span class="m">1</span><span class="w">                    </span><span class="m">5</span><span class="w">                </span><span class="nb">true</span>
</code></pre></div>
<h3 id="test-east-west-connectivity">Test East-West Connectivity</h3>
<ul>
<li>
<p>Test communication between Pods and their hosts:</p>
<div class="highlight"><pre><span></span><code>~#<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>nodes<span class="w"> </span>-owide
NAME<span class="w">     </span>STATUS<span class="w">   </span>ROLES<span class="w">           </span>AGE<span class="w">     </span>VERSION<span class="w">   </span>INTERNAL-IP<span class="w">      </span>EXTERNAL-IP<span class="w">   </span>OS-IMAGE<span class="w">                </span>KERNEL-VERSION<span class="w">              </span>CONTAINER-RUNTIME
master<span class="w">   </span>Ready<span class="w">    </span>control-plane<span class="w">   </span>2d12h<span class="w">   </span>v1.27.3<span class="w">   </span><span class="m">172</span>.31.199.183<span class="w">   </span>&lt;none&gt;<span class="w">        </span>CentOS<span class="w"> </span>Linux<span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="o">(</span>Core<span class="o">)</span><span class="w">   </span><span class="m">6</span>.4.0-1.el7.elrepo.x86_64<span class="w">   </span>containerd://1.7.1
worker<span class="w">   </span>Ready<span class="w">    </span>&lt;none&gt;<span class="w">          </span>2d12h<span class="w">   </span>v1.27.3<span class="w">   </span><span class="m">172</span>.31.199.184<span class="w">   </span>&lt;none&gt;<span class="w">        </span>CentOS<span class="w"> </span>Linux<span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="o">(</span>Core<span class="o">)</span><span class="w">   </span><span class="m">6</span>.4.0-1.el7.elrepo.x86_64<span class="w">   </span>containerd://1.7.1

~#<span class="w"> </span>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-ti<span class="w"> </span>test-app-1-ddlx7<span class="w"> </span>--<span class="w"> </span>ping<span class="w"> </span><span class="m">172</span>.31.199.183<span class="w"> </span>-c<span class="w"> </span><span class="m">2</span>
PING<span class="w"> </span><span class="m">172</span>.31.199.183<span class="w"> </span><span class="o">(</span><span class="m">172</span>.31.199.183<span class="o">)</span>:<span class="w"> </span><span class="m">56</span><span class="w"> </span>data<span class="w"> </span>bytes
<span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span><span class="m">172</span>.31.199.183:<span class="w"> </span><span class="nv">seq</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">64</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>.088<span class="w"> </span>ms
<span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span><span class="m">172</span>.31.199.183:<span class="w"> </span><span class="nv">seq</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">64</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>.054<span class="w"> </span>ms

---<span class="w"> </span><span class="m">172</span>.31.199.183<span class="w"> </span>ping<span class="w"> </span>statistics<span class="w"> </span>---
<span class="m">2</span><span class="w"> </span>packets<span class="w"> </span>transmitted,<span class="w"> </span><span class="m">2</span><span class="w"> </span>packets<span class="w"> </span>received,<span class="w"> </span><span class="m">0</span>%<span class="w"> </span>packet<span class="w"> </span>loss
round-trip<span class="w"> </span>min/avg/max<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.054/0.071/0.088<span class="w"> </span>ms
</code></pre></div>
</li>
<li>
<p>Test communication between Pods across different nodes and subnets:</p>
<div class="highlight"><pre><span></span><code>~#<span class="w"> </span>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-ti<span class="w"> </span>test-app-1-ddlx7<span class="w"> </span>--<span class="w"> </span>ping<span class="w"> </span><span class="m">172</span>.31.199.193<span class="w"> </span>-c<span class="w"> </span><span class="m">2</span>
PING<span class="w"> </span><span class="m">172</span>.31.199.193<span class="w"> </span><span class="o">(</span><span class="m">172</span>.31.199.193<span class="o">)</span>:<span class="w"> </span><span class="m">56</span><span class="w"> </span>data<span class="w"> </span>bytes
<span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span><span class="m">172</span>.31.199.193:<span class="w"> </span><span class="nv">seq</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">64</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>.460<span class="w"> </span>ms
<span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span><span class="m">172</span>.31.199.193:<span class="w"> </span><span class="nv">seq</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">64</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>.210<span class="w"> </span>ms

---<span class="w"> </span><span class="m">172</span>.31.199.193<span class="w"> </span>ping<span class="w"> </span>statistics<span class="w"> </span>---
<span class="m">2</span><span class="w"> </span>packets<span class="w"> </span>transmitted,<span class="w"> </span><span class="m">2</span><span class="w"> </span>packets<span class="w"> </span>received,<span class="w"> </span><span class="m">0</span>%<span class="w"> </span>packet<span class="w"> </span>loss
round-trip<span class="w"> </span>min/avg/max<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.210/0.335/0.460<span class="w"> </span>ms

~#<span class="w"> </span>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-ti<span class="w"> </span>test-app-1-ddlx7<span class="w"> </span>--<span class="w"> </span>ping<span class="w"> </span><span class="m">192</span>.168.0.161<span class="w"> </span>-c<span class="w"> </span><span class="m">2</span>
PING<span class="w"> </span><span class="m">192</span>.168.0.161<span class="w"> </span><span class="o">(</span><span class="m">192</span>.168.0.161<span class="o">)</span>:<span class="w"> </span><span class="m">56</span><span class="w"> </span>data<span class="w"> </span>bytes
<span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span><span class="m">192</span>.168.0.161:<span class="w"> </span><span class="nv">seq</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">64</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>.408<span class="w"> </span>ms
<span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span><span class="m">192</span>.168.0.161:<span class="w"> </span><span class="nv">seq</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">64</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>.194<span class="w"> </span>ms

---<span class="w"> </span><span class="m">192</span>.168.0.161<span class="w"> </span>ping<span class="w"> </span>statistics<span class="w"> </span>---
<span class="m">2</span><span class="w"> </span>packets<span class="w"> </span>transmitted,<span class="w"> </span><span class="m">2</span><span class="w"> </span>packets<span class="w"> </span>received,<span class="w"> </span><span class="m">0</span>%<span class="w"> </span>packet<span class="w"> </span>loss
round-trip<span class="w"> </span>min/avg/max<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.194/0.301/0.408<span class="w"> </span>ms
</code></pre></div>
</li>
<li>
<p>Test communication between Pods and ClusterIP services:</p>
<div class="highlight"><pre><span></span><code>~#<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>test-svc
NAME<span class="w">       </span>TYPE<span class="w">        </span>CLUSTER-IP<span class="w">      </span>EXTERNAL-IP<span class="w">   </span>PORT<span class="o">(</span>S<span class="o">)</span><span class="w">   </span>AGE
test-svc<span class="w">   </span>ClusterIP<span class="w">   </span><span class="m">10</span>.233.23.194<span class="w">   </span>&lt;none&gt;<span class="w">        </span><span class="m">80</span>/TCP<span class="w">    </span>26s

~#<span class="w"> </span>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-ti<span class="w"> </span>test-app-2-qbhwx<span class="w"> </span>--<span class="w"> </span>curl<span class="w"> </span><span class="m">10</span>.233.23.194<span class="w"> </span>-I
HTTP/1.1<span class="w"> </span><span class="m">200</span><span class="w"> </span>OK
Server:<span class="w"> </span>nginx/1.10.1
Date:<span class="w"> </span>Fri,<span class="w"> </span><span class="m">21</span><span class="w"> </span>Jul<span class="w"> </span><span class="m">2023</span><span class="w"> </span><span class="m">06</span>:45:56<span class="w"> </span>GMT
Content-Type:<span class="w"> </span>text/html
Content-Length:<span class="w"> </span><span class="m">4086</span>
Last-Modified:<span class="w"> </span>Fri,<span class="w"> </span><span class="m">21</span><span class="w"> </span>Jul<span class="w"> </span><span class="m">2023</span><span class="w"> </span><span class="m">06</span>:38:41<span class="w"> </span>GMT
Connection:<span class="w"> </span>keep-alive
ETag:<span class="w"> </span><span class="s2">&quot;64ba27f1-ff6&quot;</span>
Accept-Ranges:<span class="w"> </span>bytes
</code></pre></div>
</li>
</ul>
<h3 id="test-north-south-connectivity">Test North-South Connectivity</h3>
<h4 id="test-egress-traffic-from-pods-to-external-destinations">Test egress traffic from Pods to external destinations</h4>
<ul>
<li>
<p>Alibaba Cloud's NAT Gateway provides an ingress and egress gateway for public or private network traffic within a VPC environment. By utilizing NAT Gateway, the cluster can have egress connectivity. Please refer to <a href="https://www.alibabacloud.com/help/en/nat-gateway?spm=a2c63.p38356.0.0.1b111b76Rn9rPa">the NAT Gateway documentation</a> for creating a NAT Gateway as depicted in the picture:</p>
<p><img alt="alicloud-natgateway" src="../../../../images/alicloud-natgateway.png" /></p>
</li>
<li>
<p>Test egress traffic from Pods</p>
<div class="highlight"><pre><span></span><code>~#<span class="w"> </span>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-ti<span class="w"> </span>test-app-2-qbhwx<span class="w"> </span>--<span class="w"> </span>curl<span class="w"> </span>www.baidu.com<span class="w"> </span>-I
HTTP/1.1<span class="w"> </span><span class="m">200</span><span class="w"> </span>OK
Accept-Ranges:<span class="w"> </span>bytes
Cache-Control:<span class="w"> </span>private,<span class="w"> </span>no-cache,<span class="w"> </span>no-store,<span class="w"> </span>proxy-revalidate,<span class="w"> </span>no-transform
Connection:<span class="w"> </span>keep-alive
Content-Length:<span class="w"> </span><span class="m">277</span>
Content-Type:<span class="w"> </span>text/html
Date:<span class="w"> </span>Fri,<span class="w"> </span><span class="m">21</span><span class="w"> </span>Jul<span class="w"> </span><span class="m">2023</span><span class="w"> </span><span class="m">08</span>:42:17<span class="w"> </span>GMT
Etag:<span class="w"> </span><span class="s2">&quot;575e1f60-115&quot;</span>
Last-Modified:<span class="w"> </span>Mon,<span class="w"> </span><span class="m">13</span><span class="w"> </span>Jun<span class="w"> </span><span class="m">2016</span><span class="w"> </span><span class="m">02</span>:50:08<span class="w"> </span>GMT
Pragma:<span class="w"> </span>no-cache
Server:<span class="w"> </span>bfe/1.0.8.18
</code></pre></div>
</li>
<li>
<p>If you want to access the traffic egress of Pods in the cluster through IPv6 addresses, you need to activate public network bandwidth for the IPv6 address assigned to the Pod through the IPv6 gateway and convert the private IPv6 to a public IPv6 address. The configuration is as follows.</p>
<p><img alt="alicloud-ipv6-natgateway" src="../../../../images/alicloud-ipv6-gateway.png" /></p>
<p>Test Pod egress traffic over IPv6:</p>
<div class="highlight"><pre><span></span><code>~#<span class="w"> </span>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-ti<span class="w"> </span>test-app-2-qbhwx<span class="w"> </span>--<span class="w"> </span>ping<span class="w"> </span>-6<span class="w"> </span>aliyun.com<span class="w"> </span>-c<span class="w"> </span><span class="m">2</span>
PING<span class="w"> </span>aliyun.com<span class="w"> </span><span class="o">(</span><span class="m">2401</span>:b180:1:60::6<span class="o">)</span>:<span class="w"> </span><span class="m">56</span><span class="w"> </span>data<span class="w"> </span>bytes
<span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span><span class="m">2401</span>:b180:1:60::6:<span class="w"> </span><span class="nv">seq</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">96</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">6</span>.058<span class="w"> </span>ms
<span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span><span class="m">2401</span>:b180:1:60::6:<span class="w"> </span><span class="nv">seq</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">96</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">6</span>.079<span class="w"> </span>ms

---<span class="w"> </span>aliyun.com<span class="w"> </span>ping<span class="w"> </span>statistics<span class="w"> </span>---
<span class="m">2</span><span class="w"> </span>packets<span class="w"> </span>transmitted,<span class="w"> </span><span class="m">2</span><span class="w"> </span>packets<span class="w"> </span>received,<span class="w"> </span><span class="m">0</span>%<span class="w"> </span>packet<span class="w"> </span>loss
round-trip<span class="w"> </span>min/avg/max<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span>.058/6.068/6.079<span class="w"> </span>ms
</code></pre></div>
</li>
</ul>
<h4 id="load-balancer-traffic-ingress-access">Load Balancer Traffic Ingress Access</h4>
<h5 id="deploy-cloud-controller-manager">Deploy Cloud Controller Manager</h5>
<p>Cloud Controller Manager (CCM) is an Alibaba Cloud's component that enables integration between Kubernetes and Alibaba Cloud services. We will use CCM along with Alibaba Cloud infrastructure to facilitate load balancer traffic ingress access. Follow the steps below and refer to <a href="https://github.com/kubernetes/cloud-provider-alibaba-cloud/blob/master/docs/getting-started.md">the CCM documentation</a> for deploying CCM.</p>
<ol>
<li>
<p>Configure <code>providerID</code> on Cluster Nodes</p>
<p>On each node in the cluster, run the following command to obtain the <code>providerID</code> for each node. <a href="http://100.100.100.200/latest/meta-data">http://100.100.100.200/latest/meta-data</a> is the API entry point provided by Alibaba Cloud CLI for retrieving instance metadata. You don't need to modify it in the provided example. For more information, please refer to <a href="https://www.alibabacloud.com/help/en/ecs/user-guide/overview-of-ecs-instance-metadata?spm=a2c63.p38356.0.0.1c3c592dPUwXMN">ECS instance metadata</a>.</p>
<div class="highlight"><pre><span></span><code>~#<span class="w"> </span><span class="nv">META_EP</span><span class="o">=</span>http://100.100.100.200/latest/meta-data
~#<span class="w"> </span><span class="nv">provider_id</span><span class="o">=</span><span class="sb">`</span>curl<span class="w"> </span>-s<span class="w"> </span><span class="nv">$META_EP</span>/region-id<span class="sb">`</span>.<span class="sb">`</span>curl<span class="w"> </span>-s<span class="w"> </span><span class="nv">$META_EP</span>/instance-id<span class="sb">`</span>
~#<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$provider_id</span>
cn-hangzhou.i-bp17345hor9*******
</code></pre></div>
<p>On the <code>master</code> node of the cluster, use the <code>kubectl patch</code> command to add the <code>providerID</code> for each node in the cluster. This step is necessary to ensure the proper functioning of the CCM Pod on each corresponding node. Failure to run this step will result in the CCM Pod being unable to run correctly.</p>
<div class="highlight"><pre><span></span><code>~#<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>nodes
~#<span class="w"> </span>kubectl<span class="w"> </span>patch<span class="w"> </span>node<span class="w"> </span>&lt;NODE_NAME&gt;<span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;{&quot;spec&quot;:{&quot;providerID&quot;: &quot;&lt;provider_id&gt;&quot;}}&#39;</span><span class="w"> </span><span class="c1"># Replace &lt;NODE_NAME&gt; and &lt;provider_id&gt; with corresponding values.</span>
</code></pre></div>
</li>
<li>
<p>Create an Alibaba Cloud RAM user and grant authorization.</p>
<p>A RAM user is an entity within Alibaba Cloud's Resource Access Management (RAM) that represents individuals or applications requiring access to Alibaba Cloud resources. Refer to <a href="https://www.alibabacloud.com/help/en/ram/user-guide/overview-of-ram-users?spm=a2c63.p38356.0.0.435a7b9fxy619R">Overview of RAM users</a> to create a RAM user and assign the necessary permissions for accessing resources.</p>
<p>To ensure that the RAM user used in the subsequent steps has sufficient privileges, grant the <code>AdministratorAccess</code> and <code>AliyunSLBFullAccess</code> permissions to the RAM user, following the instructions provided here.</p>
</li>
<li>
<p>Obtain the AccessKey &amp; AccessKeySecret for the RAM user.</p>
<p>Log in to the RAM User account and go to <a href="https://account.alibabacloud.com/login/login.htm?spm=5176.12901015-2.0.0.36cb525cXk2SG0">User Center</a> to retrieve the corresponding AccessKey &amp; AccessKeySecret for the RAM User.</p>
</li>
<li>
<p>Create the Cloud ConfigMap for CCM.</p>
<p>Use the following method to write the AccessKey &amp; AccessKeySecret obtained in step 3 as environment variables.</p>
<div class="highlight"><pre><span></span><code>~#<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">ACCESS_KEY_ID</span><span class="o">=</span>LTAI********************
~#<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">ACCESS_KEY_SECRET</span><span class="o">=</span>HAeS**************************
</code></pre></div>
<p>Run the following command to create cloud-config:</p>
<div class="highlight"><pre><span></span><code><span class="nv">accessKeyIDBase64</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ACCESS_KEY_ID</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span>base64<span class="w"> </span>-w<span class="w"> </span><span class="m">0</span><span class="sb">`</span>
<span class="nv">accessKeySecretBase64</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$ACCESS_KEY_SECRET</span><span class="s2">&quot;</span><span class="p">|</span>base64<span class="w"> </span>-w<span class="w"> </span><span class="m">0</span><span class="sb">`</span>

cat<span class="w"> </span><span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<span class="s">apiVersion: v1</span>
<span class="s">kind: ConfigMap</span>
<span class="s">metadata:</span>
<span class="s">  name: cloud-config</span>
<span class="s">  namespace: kube-system</span>
<span class="s">data:</span>
<span class="s">  cloud-config.conf: |-</span>
<span class="s">    {</span>
<span class="s">        &quot;Global&quot;: {</span>
<span class="s">            &quot;accessKeyID&quot;: &quot;$accessKeyIDBase64&quot;,</span>
<span class="s">            &quot;accessKeySecret&quot;: &quot;$accessKeySecretBase64&quot;</span>
<span class="s">        }</span>
<span class="s">    }</span>
<span class="s">EOF</span>
</code></pre></div>
</li>
<li>
<p>Retrieve the YAML file and install CCM by running the command <code>kubectl apply -f cloud-controller-manager.yaml</code>. The version of CCM being installed here is v2.5.0.</p>
<ul>
<li>Use the following command to obtain the cloud-controller-manager.yaml file and replace <code>&lt;&lt;cluster_cidr&gt;&gt;</code> with the actual cluster CIDR; You can view the cluster CIDR of the cluster through the <code>kubectl cluster-info dump | grep -m1 cluster-cidr</code> command.</li>
</ul>
<div class="highlight"><pre><span></span><code>~#<span class="w"> </span>wget<span class="w"> </span>https://raw.githubusercontent.com/spidernet-io/spiderpool/main/docs/example/alicloud-ccm/cloud-controller-manager.yaml
~#<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>cloud-controller-manager.yaml
</code></pre></div>
</li>
<li>
<p>Verify if CCM is installed.</p>
<div class="highlight"><pre><span></span><code>~#<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>po<span class="w"> </span>-n<span class="w"> </span>kube-system<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>cloud-controller-manager
NAME<span class="w">                                     </span>READY<span class="w">   </span>STATUS<span class="w">      </span>RESTARTS<span class="w">        </span>AGE
cloud-controller-manager-72vzr<span class="w">           </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">               </span>27s
cloud-controller-manager-k7jpn<span class="w">           </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">               </span>27s
</code></pre></div>
</li>
</ol>
<h5 id="create-load-balancer-ingress-for-applications">Create Load Balancer Ingress for Applications</h5>
<p>The following YAML will create two sets of services, one for TCP (layer 4 load balancing) and one for HTTP (layer 7 load balancing), with <code>spec.type</code> set to <code>LoadBalancer</code>.</p>
<ul>
<li>
<p><code>service.beta.kubernetes.io/alibaba-cloud-loadbalancer-protocol-port</code>: this annotation provided by CCM allows you to customize the exposed ports for layer 7 load balancing. For more information, refer to <a href="https://github.com/kubernetes/cloud-provider-alibaba-cloud/blob/master/docs/usage.md">the CCM Usage Documentation</a>.</p>
</li>
<li>
<p><code>.spec.externalTrafficPolicy</code>: indicates whether the service prefers to route external traffic to local or cluster-wide endpoints. It has two options: Cluster (default) and Local. Setting <code>.spec.externalTrafficPolicy</code> to <code>Local</code> preserves the client source IP. However, when a self-built public cloud cluster uses the platform's Loadbalancer component for nodePort forwarding in this mode, access will be blocked. In response to this problem, Spiderpool provides the coordinator plug-in, which uses iptables to mark the data packets to confirm that the reply packets of data entering from veth0 are still forwarded from veth0, thus solving the problem of nodeport being unable to access in this mode.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code>~#<span class="w"> </span>cat<span class="w"> </span><span class="s">&lt;&lt;EOF | kubectl apply -f -</span>
<span class="s">apiVersion: v1</span>
<span class="s">kind: Service</span>
<span class="s">metadata:</span>
<span class="s">  name: tcp-service</span>
<span class="s">  namespace: default</span>
<span class="s">spec:</span>
<span class="s">  externalTrafficPolicy: Local</span>
<span class="s">  ports:</span>
<span class="s">  - name: tcp</span>
<span class="s">    port: 999</span>
<span class="s">    protocol: TCP</span>
<span class="s">    targetPort: 80</span>
<span class="s">  selector:</span>
<span class="s">    app: test-app-2</span>
<span class="s">  type: LoadBalancer</span>
<span class="s">---</span>
<span class="s">apiVersion: v1</span>
<span class="s">kind: Service</span>
<span class="s">metadata:</span>
<span class="s">  annotations:</span>
<span class="s">    service.beta.kubernetes.io/alibaba-cloud-loadbalancer-protocol-port: &quot;http:80&quot;</span>
<span class="s">  name: http-service</span>
<span class="s">  namespace: default</span>
<span class="s">spec:</span>
<span class="s">  externalTrafficPolicy: Local</span>
<span class="s">  ports:</span>
<span class="s">  - port: 80</span>
<span class="s">    protocol: TCP</span>
<span class="s">    targetPort: 80</span>
<span class="s">  selector:</span>
<span class="s">    app: test-app-2</span>
<span class="s">  type: LoadBalancer</span>
<span class="s">EOF</span>
</code></pre></div>
<p>After the creation is complete, you can view the following:</p>
<div class="highlight"><pre><span></span><code>~#<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span><span class="p">|</span>grep<span class="w"> </span>service
NAME<span class="w">           </span>TYPE<span class="w">           </span>CLUSTER-IP<span class="w">      </span>EXTERNAL-IP<span class="w">      </span>PORT<span class="o">(</span>S<span class="o">)</span><span class="w">         </span>AGE
http-service<span class="w">   </span>LoadBalancer<span class="w">   </span><span class="m">10</span>.233.1.108<span class="w">    </span><span class="m">121</span>.41.165.119<span class="w">   </span><span class="m">80</span>:30698/TCP<span class="w">    </span>11s
tcp-service<span class="w">    </span>LoadBalancer<span class="w">   </span><span class="m">10</span>.233.4.245<span class="w">    </span><span class="m">47</span>.98.137.75<span class="w">     </span><span class="m">999</span>:32635/TCP<span class="w">   </span>15s
</code></pre></div>
<p>CCM will automatically create layer 4 and layer 7 load balancers at its IaaS services. You can easily access and manage them through the Alibaba Cloud console, as shown below:</p>
<p><img alt="alicloud-loadbalancer" src="../../../../images/alicloud-loadbalancer.png" /></p>
<h5 id="verify-load-balancer-traffic-ingress-access">Verify Load Balancer Traffic Ingress Access</h5>
<p>On a public machine, access the load balancer's public IP + port to test the traffic ingress:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Access layer 4 load balancing</span>
$<span class="w"> </span>curl<span class="w"> </span><span class="m">47</span>.98.137.75:999<span class="w"> </span>-I
HTTP/1.1<span class="w"> </span><span class="m">200</span><span class="w"> </span>OK
Server:<span class="w"> </span>nginx/1.25.1
Date:<span class="w"> </span>Sun,<span class="w"> </span><span class="m">30</span><span class="w"> </span>Jul<span class="w"> </span><span class="m">2023</span><span class="w"> </span><span class="m">09</span>:12:46<span class="w"> </span>GMT
Content-Type:<span class="w"> </span>text/html
Content-Length:<span class="w"> </span><span class="m">615</span>
Last-Modified:<span class="w"> </span>Tue,<span class="w"> </span><span class="m">13</span><span class="w"> </span>Jun<span class="w"> </span><span class="m">2023</span><span class="w"> </span><span class="m">15</span>:08:10<span class="w"> </span>GMT
Connection:<span class="w"> </span>keep-alive
ETag:<span class="w"> </span><span class="s2">&quot;6488865a-267&quot;</span>
Accept-Ranges:<span class="w"> </span>bytes

<span class="c1"># Access layer 7 load balancing</span>
$<span class="w"> </span>curl<span class="w"> </span><span class="m">121</span>.41.165.119:80<span class="w"> </span>-I
HTTP/1.1<span class="w"> </span><span class="m">200</span><span class="w"> </span>OK
Date:<span class="w"> </span>Sun,<span class="w"> </span><span class="m">30</span><span class="w"> </span>Jul<span class="w"> </span><span class="m">2023</span><span class="w"> </span><span class="m">09</span>:13:17<span class="w"> </span>GMT
Content-Type:<span class="w"> </span>text/html
Content-Length:<span class="w"> </span><span class="m">615</span>
Connection:<span class="w"> </span>keep-alive
Last-Modified:<span class="w"> </span>Tue,<span class="w"> </span><span class="m">13</span><span class="w"> </span>Jun<span class="w"> </span><span class="m">2023</span><span class="w"> </span><span class="m">15</span>:08:10<span class="w"> </span>GMT
ETag:<span class="w"> </span><span class="s2">&quot;6488865a-267&quot;</span>
Accept-Ranges:<span class="w"> </span>bytes
</code></pre></div>
<blockquote>
<p>Alibaba Cloud's CCM implements ingress access for load balancing traffic, and it does not support setting the <code>spec.ipFamilies</code> of the backend service to IPv6.</p>
</blockquote>
<div class="highlight"><pre><span></span><code>~#<span class="w"> </span>kubectl<span class="w"> </span>describe<span class="w"> </span>svc<span class="w"> </span>lb-ipv6
...
Events:
<span class="w">  </span>Type<span class="w">     </span>Reason<span class="w">                  </span>Age<span class="w">                   </span>From<span class="w">            </span>Message
<span class="w">  </span>----<span class="w">     </span>------<span class="w">                  </span>----<span class="w">                  </span>----<span class="w">            </span>-------
<span class="w">  </span>Warning<span class="w">  </span>SyncLoadBalancerFailed<span class="w">  </span>3m5s<span class="w"> </span><span class="o">(</span>x37<span class="w"> </span>over<span class="w"> </span>159m<span class="o">)</span><span class="w">  </span>nlb-controller<span class="w">  </span>Error<span class="w"> </span>syncing<span class="w"> </span>load<span class="w"> </span>balancer<span class="w"> </span><span class="o">[</span>nlb-rddqbe6gnp9jil4i15<span class="o">]</span>:<span class="w"> </span>Message:<span class="w"> </span>code:<span class="w"> </span><span class="m">400</span>,<span class="w"> </span>The<span class="w"> </span>operation<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>allowed<span class="w"> </span>because<span class="w"> </span>of<span class="w"> </span>ServerGroupNotSupportIpv6.
</code></pre></div>
<h2 id="summary">Summary</h2>
<p>Spiderpool is successfully running in an Alibaba Cloud cluster, ensuring normal east-west and north-south traffic.</p>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../../overlay/get-started-cilium/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Cilium" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Cilium
            </div>
          </div>
        </a>
      
      
        
        <a href="../get-started-aws/" class="md-footer__link md-footer__link--next" aria-label="Next: AWS Cloud" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              AWS Cloud
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.instant", "navigation.top", "navigation.tracking", "search.highlight", "search.suggest", "search.share"], "search": "../../../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
    
    
  </body>
</html>